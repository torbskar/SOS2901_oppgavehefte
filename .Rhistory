output_extension = ".csv",
button_label = "Download data as csv",
button_type = "default",
has_icon = TRUE,
icon = "fa fa-save"
)
#| warning: false
#| error: false
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
skim(kommune)
#| warning: false
#| message: false
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
round(summary(est)$r.squared, digits = 3)
rmse <- sqrt(mean(est$res^2))
rmse
kom <- kommune %>%
mutate(pred = predict(est))
ggplot(kom, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
dt <- data.frame(prop_unge_menn = .15)
predict(est, newdata = dt)
predict(est, newdata = dt, interval = "prediction")
est_m <- lm(voldskriminalitet ~ prop_unge_menn + inntekt_totalt_median + shj_unge +
ant_husholdninger ,
data=kommune)
summary(est_m)
#| warning: false
#| error: false
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
ggplot(kom_pred, aes(x = voldskriminalitet, y = pred)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
kom_s <- kom_2016 %>%
select(-c(kommune, lovb_ialt, Orden,
Rusmiddellovbrudd, Trafikkovertredelse,
lovb_annet, prop_unge_menn))
full_mod <- lm(Vold ~ . , data = kom_s)
summary(full_mod)
full_mod2 <- lm( Vold ~ .^2, data = kom_s)
summary(full_mod2)$r.squared
full_mod3 <- lm( Vold ~ .^3, data = kom_s)
summary(full_mod3)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="backward",
trace = FALSE)
kom_s <- kommune %>%
select(-c(kommune, lovb_ialt, Orden,
Rusmiddellovbrudd, Trafikkovertredelse,
lovb_annet, prop_unge_menn))
glimpse(kommune)
kom_s <- kommune %>%
select(-c(kommune, kommune_nr, ordenslovbrudd,
nark_alko_kriminalitet, trafikklovbrudd, andre_lovbrudd,
prop_unge_menn))
full_mod <- lm(Vold ~ . , data = kom_s)
full_mod <- lm(voldskriminalitet ~ . , data = kom_s)
summary(full_mod)
full_mod2 <- lm( voldskriminalitet ~ .^2, data = kom_s)
summary(full_mod2)$r.squared
full_mod3 <- lm( voldskriminalitet ~ .^3, data = kom_s)
summary(full_mod3)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="backward",
trace = FALSE)
summary(step_mod)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="forward",
trace = FALSE)
summary(step_mod)$r.squared
summary(step_mod)
summary(step_mod)$r.squared
kom_pred <- kom_s %>%
mutate(pred = predict(step_mod))
ggplot(kom_pred, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_s %>%
mutate(pred = predict(step_mod),
residual = pred - voldskriminalitet) %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
Sys.setlocale(locale='no_NB.utf8')
getwd()
Sys.setlocale(locale='no_NB.utf8')
Sys.setlocale(locale='no_NB.utf8')
library(rsample)
kommune_train <- training(kommune)
set.seed(42)
initial_split(kommune, prop = .7)
kommune <- readRDS( "data/kommunedata.rds")
set.seed(42)
initial_split(kommune, prop = .7)
kommune_train <- training(kommune)
kommune_split <- initial_split(kommune, prop = .7)
kommune_train <- training(kommune_split)
kommune_train <- training(kommune_split)
kommune_test <- training(kommune_split)
kommune_train <- kommune_train %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
kommune_train <- kommune_train
kommune_train <- kommune_train %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
library(skimr)
library(tidyverse)
kommune_train <- kommune_train %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
#| warning: false
#| message: false
kommune_train <- kommune_train %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
ggplot(kommune_train, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
kom <- kommune_train %>%
mutate(pred = predict(est))
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test)
#| echo: false
#| warning: false
#| message: false
library(skimr)
library(tidyverse)
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
skim(kommune)
library(rsample)
set.seed(42)
kommune_split <- initial_split(kommune, prop = .7)
kommune_train <- training(kommune_split)
kommune_test <- training(kommune_split)
#| warning: false
#| message: false
kommune_train <- kommune_train %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune_train, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data = kommune_train)
summary(est)
round(summary(est)$r.squared, digits = 3)
rmse <- sqrt(mean(est$res^2))
rmse
kom <- kommune_train %>%
mutate(pred = predict(est))
ggplot(kom, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
dt <- data.frame(prop_unge_menn = .15)
predict(est, newdata = dt)
predict(est, newdata = dt, interval = "prediction")
est_m <- lm(voldskriminalitet ~ prop_unge_menn + inntekt_totalt_median + shj_unge +
ant_husholdninger ,
data = kommune_train)
summary(est_m)
#| warning: false
#| error: false
kom_pred <- kommune_train %>%
mutate(pred = predict(est_m))
ggplot(kom_pred, aes(x = voldskriminalitet, y = pred)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
glimpse(kommune_train)
kom_s <- kommune_train %>%
select(-c(kommune, kommune_nr, ordenslovbrudd,
nark_alko_kriminalitet, trafikklovbrudd, andre_lovbrudd,
prop_unge_menn))
full_mod <- lm(voldskriminalitet ~ . , data = kom_s)
summary(full_mod)
full_mod2 <- lm( voldskriminalitet ~ .^2, data = kom_s)
summary(full_mod2)$r.squared
full_mod3 <- lm( voldskriminalitet ~ .^3, data = kom_s)
summary(full_mod3)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="forward",
trace = FALSE)
summary(step_mod)$r.squared
#| warning: false
#| error: false
kom_pred <- kom_s %>%
mutate(pred = predict(step_mod))
ggplot(kom_pred, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_s %>%
mutate(pred = predict(step_mod),
residual = pred - voldskriminalitet) %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
#| warning: false
#| error: false
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test,
residual = pred - voldskriminalitet)
kom_pred2 %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test,
residual = pred - voldskriminalitet)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2 %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
kom_pred2 %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
kom_pred2
mutate(res_y = y - mean(y)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(res_y^2)) %>%
mutate(r_squared = 1 - res_pred/res_y)
kom_pred2
mutate(res_y = y - mean(y))
kom_pred2
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - res_pred/residual_total)
kom_pred2
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet))
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet))
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - res_pred/residual_total)
kom_pred2
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test,
residual = pred - voldskriminalitet)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2))
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - SSres/SStot)
summary(step_mod)$r.squared
library(rsample)
set.seed(42)
kommune_split <- initial_split(kommune, prop = .7)
kommune_train <- training(kommune_split)
kommune_test <- testing(kommune_split)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test,
residual = pred - voldskriminalitet)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test,
residual = pred - voldskriminalitet)
?predict
?predict.lm
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod), newdata = kommune_test)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = kommune_test))
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = kommune_test),
residual = pred - voldskriminalitet)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - SSres/SStot)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = kommune_test),
residual = pred - voldskriminalitet)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - SSres/SStot)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = kommune_test),
residual = pred - voldskriminalitet)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = kommune_test),
residual = pred - voldskriminalitet)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2 %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
kom_pred2 <- kommune_test %>%
mutate(pred = predict(full_mod2, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
full_mod
kom_pred3 <- kommune_test %>%
mutate(pred = predict(full_mod, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred3, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred3  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
summary(full_mod)
kom_pred3 <- kommune_test %>%
mutate(pred = predict(full_mod2, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred3, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred3 <- kommune_test %>%
mutate(pred = predict(full_mod, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred3, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred3  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred3 %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
kom_pred2 <- kom_pred2 %>%
filter(pred > 100)
kom_pred2 <- kom_pred2 %>%
filter(pred < 100)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2 <- kommune_test %>%
mutate(pred = predict(step_mod, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
summary(kom_pred2$pred)
kom_pred2 <- kom_pred2 %>%
filter(pred < 1000)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred3 <- kommune_test %>%
mutate(pred = predict(full_mod, newdata = .),
residual = pred - voldskriminalitet)
kom_s %>%
mutate(pred = predict(step_mod),
residual = pred - voldskriminalitet) %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2 <- kom_pred2 %>%
filter(pred < 200)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2 <- kom_pred2 %>%
filter( abs(pred) < 200)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2 <- kom_pred2 %>%
filter( abs(pred) < 50)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_s  %>%
mutate(pred = predict(step_mod) - voldskriminalitet) %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_s  %>%
mutate(pred = predict(step_mod),
residual = pred - voldskriminalitet) %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2  %>%
mutate(pred = predict(step_mod, newdata = .),
residual = pred - voldskriminalitet) %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2 <- kom_pred2 %>%
filter( abs(pred) < 30)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2 <- kom_pred2 %>%
filter( abs(pred) < 25)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2 <- kom_pred2 %>%
filter( abs(pred) < 20)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred2 <- kom_pred2 %>%
filter( abs(pred) < 15)
ggplot(kom_pred2, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred2  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
kom_pred3 <- kommune_test %>%
mutate(pred = predict(full_mod, newdata = .),
residual = pred - voldskriminalitet)
ggplot(kom_pred3, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_pred3  %>%
mutate(residual_total = voldskriminalitet - mean(voldskriminalitet)) %>%
summarise(SSres = sum(residual^2),
SStot = sum(residual_total^2)) %>%
mutate(r_squared = 1 - (SSres/SStot))
summary(full_mod)$r.squared
kom_pred3 %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
