pred_rate_parity(data = attrition_test,
outcome = "Attrition",
group = "JobRole",
preds = "attrition_class",
base = "Laboratory Technician"
)[[2]]
pred_rate_parity(data = attrition_test,
outcome = "Attrition",
group = "JobRole",
preds = "attrition_class",
base = "Laboratory Technician"
)[[2]]
?initial_split
library(rsample)
?initial_split
#| eval: true
#| code-fold: false
#| echo: true
#| warning: false
#| message: false
library(tidyverse)   # datahåndtering, grafikk og glimpse()
library(skimr)       # funksjonen skim() for å se på data
library(rsample)     # for å dele data i training og testing
#| echo: false
#| warning: false
#| message: false
library(skimr)
library(tidyverse)
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
skim(kommune)
library(rsample)
set.seed(42)
kommune_split <- initial_split(kommune, prop = .7)
kommune_train <- training(kommune_split)
kommune_test <- testing(kommune_split)
#| warning: false
#| message: false
kommune_train <- kommune_train %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune_train, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data = kommune_train)
summary(est)
#| code-fold: false
summary(est)$r.squared
library(gtsummary)
tbl_regression(est, intercept = TRUE)
#| echo: false
library(equatiomatic)
extract_eq(est, use_coefs = TRUE)
#| code-fold: false
rmse <- sqrt(mean(est$res^2))
rmse
#| code-fold: false
kom <- kommune_train %>%
mutate(pred = predict(est))
#| warning: false
#| error: false
#| message: false
ggplot(kom, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
#| code-fold: false
dt <- data.frame(prop_unge_menn = .15)
predict(est, newdata = dt)
round(predict(est, newdata = dt), digits = 3)
round(predict(est, newdata = dt), digits = 3)*100
#| code-fold: false
dt <- data.frame(prop_unge_menn = 15)
p <- predict(est, newdata = dt)
p
p_ki <- predict(est, newdata = dt, interval = "prediction")
p_ki
p_ki[2]
round(p_ki[2], 3)
round(p_ki[2], 1)
round(p_ki[3], 1)
?confusionMatrix
#| eval: false
library(caret)
#| eval: false
library(caret)
?confusionMatrix
#| eval: false
?confusionMatrix
#| echo: false
#| warning: false
#| message: false
library(caret)
26/(26+42)
attr(cm)
str(cm)
cm
cm
cm <- confusionMatrix(attrition_test$Attrition, attrition_test$attrition_class, positive = "Yes")
#| eval: true
#| code-fold: false
#| echo: true
#| warning: false
#| message: false
library(tidyverse)   # Datahåndtering, grafikk og glimpse()
library(rsample)     # for å dele data i training og testing
library(caret)       # Funksjonen confusionMatrix()
library(fairness)    # Beregne mål på fairness
#| echo: false
#| warning: false
#| message: false
attrition <- readRDS("data/attrition.rds")
set.seed(426)
attrition_split <- initial_split(attrition)
training <- training(attrition_split)
testing  <- testing(attrition_split)
est_multlogit <- glm(Attrition ~ ., data = training, family = "binomial")
summary(est_multlogit)
attrition_test <- testing %>%
mutate(prob = predict(est_multlogit, newdata = testing, type = "response")) %>%
mutate(attrition_class = as.factor(ifelse(prob < .5, "No", "Yes")))
cm <- confusionMatrix(attrition_test$Attrition, attrition_test$attrition_class, positive = "Yes")
cm$table
cm$byClass
cm$byClass[4]
cm$byClass[3]
cm
26/(12+26)
cm$byClass[1]
gtsummary::tbl_summary(attrition_test, include = JobRole, by = Attrition, percent = "row")
#| echo: false
library(gtsummary)
tbl_summary(attrition_test, include = JobRole, by = Attrition, percent = "row") %>%
add_overall()
pred_rate_parity(data = attrition_test,
outcome = "Attrition",
group = "JobRole",
preds = "attrition_class",
base = "Laboratory Technician"
)
tbl_summary(attrition_test, include = JobRole, by = attrition_class, percent = "row") %>%
add_overall()
tbl_summary(attrition_test, include = JobRole, by = Attrition, percent = "row") %>%
add_overall()
tbl_summary(attrition_test, include = JobRole, by = Attrition_class, percent = "row") %>%
add_overall()
tbl_summary(attrition_test, include = JobRole, by = attrition_class, percent = "row") %>%
add_overall()
tbl_summary(attrition_test, include = JobRole, by = Attrition, percent = "row") %>%
add_overall()
cm1
labTech <- attrition_test %>%
filter(JobRole %in% c("Laboratory Technician"))
others <- attrition_test %>%
filter( !(JobRole %in% c("Laboratory Technician") ))
cm1 <- confusionMatrix(labTech$Attrition, labTech$attrition_class, positive = "Yes")
cm2 <- confusionMatrix(others$Attrition, others$attrition_class, positive = "Yes")
cm1
cm2
39/(39+8)
1-39/(39+8)
equal_odds(data = attrition_test,
outcome = "Attrition",
group = "JobRole",
preds = "attrition_class",
base = "Laboratory Technician"
)
equal_odds(data = attrition_test,
outcome = "Attrition",
group = "JobRole",
preds = "attrition_class",
base = "Laboratory Technician"
)[[2]]
fpr_parity(data = attrition_test,
outcome = "Attrition",
group = "JobRole",
preds = "attrition_class",
base = "Laboratory Technician"
)[[2]]
diabetic <- read.csv("data/diabetic_data.csv", stringsAsFactors = TRUE)
glimpse(diabetic)
#| echo: false
diabetic %>%
download_this(
output_name = "diabetic dataset",
output_extension = ".rds",
button_label = "Download data as rds",
button_type = "default",
has_icon = TRUE,
icon = "fa fa-save"
)
library(tidyverse)
library(downloadthis)
diabetic <- read.csv("data/diabetic_data.csv", stringsAsFactors = TRUE)
glimpse(diabetic)
#| echo: false
diabetic %>%
download_this(
output_name = "diabetic dataset",
output_extension = ".rds",
button_label = "Download data as rds",
button_type = "default",
has_icon = TRUE,
icon = "fa fa-save"
)
#| eval: true
#| code-fold: false
#| echo: true
#| warning: false
#| message: false
library(tidyverse)   # datahåndtering, grafikk og glimpse()
library(skimr)       # funksjonen skim() for å se på data
library(rsample)     # for å dele data i training og testing
library(pROC)        # Beregne ROC-curve
library(gtsummary)   # Pent formatert regresjonstabell
library(caret)       # Funksjonen confusionMatrix()
#| warning: false
#| message: false
attrition <- readRDS("data/attrition.rds")
skim(attrition)
#| warning: false
#| message: false
attrition <- attrition %>%
select(- EmployeeNumber)
glimpse(attrition)
#| warning: false
#| message: false
set.seed(426)
attrition_split <- initial_split(attrition)
training <- training(attrition_split)
testing  <- testing(attrition_split)
nrow(attrition)
nrow(training)
nrow(testing)
str(training$Attrition)
head(training$Attrition)
levels(training$Attrition)
training$Attrition <- as.numeric(training$Attrition == "Yes")
head(training$Attrition)
mean(training$Attrition)
#| warning: false
#| message: false
training_p <- training %>%
group_by(Age) %>%
summarise(Attrition = mean(Attrition == 1))
ggplot(training_p, aes(x=Age, y=Attrition))+
geom_point()
lm_est <- lm(Attrition ~ Age , data = training)
summary(lm_est)
#| echo: false
library(equatiomatic)
extract_eq(lm_est, use_coefs = TRUE, coef_digits = 3)
#| warning: false
#| message: false
n_data <- data.frame(Age = seq(18, 65))
n_data$pred <- predict(lm_est, newdata = n_data)
ggplot(training_p, aes(x=Age, y=Attrition))+
geom_point()+
geom_line(data =n_data, aes(x = Age, y = pred))
est_logit <- glm(Attrition ~ Age, data = training, family = "binomial")
summary(est_logit)
tbl_regression(est_logit)
#| echo: false
library(equatiomatic)
extract_eq(est_logit, use_coefs = TRUE, coef_digits = 3)
#| warning: false
#| message: false
ggplot(training, aes(x=Age, y=Attrition))+
geom_point(alpha=.3)+
stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE, col="red")
#| warning: false
#| message: false
ggplot(training, aes(x=Age, y=Attrition))+
geom_jitter(height = .02, alpha=.3)+
stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE, col="red")
#| warning: false
#| message: false
training_p <- training %>%
group_by(Age) %>%
summarise(Attrition = mean(Attrition == 1))
ggplot(training_p, aes(x=Age, y=Attrition))+
geom_point()+
stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE, col="red")
attrition_pred <- training %>%
mutate(prob = predict(est_logit, type = "response"))
ROC <- roc( attrition_pred$Attrition, attrition_pred$prob )
df <- data.frame(Sensitivity = ROC$sensitivities,
Specificity = ROC$specificities)
ggplot(df, aes(y = Sensitivity, x= (1-Specificity))) +
geom_line() +
geom_abline(intercept = 0, slope = 1, col = "gray")+
coord_equal()
est_multlogit <- glm(Attrition ~ ., data = training, family = "binomial")
summary(est_multlogit)
attrition_pred <- training %>%
mutate(prob = predict(est_multlogit, type = "response"))
ROC <- roc(attrition_pred, Attrition, prob)
df <- data.frame(Sensitivity = ROC$sensitivities,
Specificity = ROC$specificities)
ggplot(df, aes(y = Sensitivity, x= (1-Specificity))) +
geom_line() +
geom_abline(intercept = 0, slope = 1, col = "gray")+
coord_equal()
auc(ROC)
attrition_test <- testing %>%
mutate(prob = predict(est_multlogit, newdata = testing, type = "response"))
ROC_test <- roc(attrition_test, Attrition, prob)
df <- data.frame(Sensitivity = ROC_test$sensitivities,
Specificity = ROC_test$specificities)
ggplot(df, aes(y = Sensitivity, x= (1-Specificity))) +
geom_line() +
geom_abline(intercept = 0, slope = 1, col = "gray")+
coord_equal()
auc(ROC_test)
#| message: false
#| warning: false
ggplot(attrition_test, aes(x = prob)) +
geom_histogram()
attrition_test <- attrition_test %>%
mutate(attrition_class = as.factor(ifelse(prob < .5, "No", "Yes")))
tab <- attrition_test %>%
select(Attrition, attrition_class) %>%
table()
tab
tab[2,2]
tab[2,1]
tab[2,2]
tab[2,]
sum(tab[2,])
tab[1,2]
tab[2,2]/sum(tab[2,])
set.seed(42)
grense <- 0.7
lottery <- runif(n = nrow(credit))
training <- filter(credit, lottery < grense)
credit <- read.csv("../data/credit.csv", stringsAsFactors = TRUE)
set.seed(42)
grense <- 0.7
lottery <- runif(n = nrow(credit))
training <- filter(credit, lottery < grense)
testing  <- filter(credit, lottery >= grense)
credit_tree <- rpart(default ~ age + amount + percent_of_income + purpose + employment_duration + housing,
data=training, method="class")
#| eval: true
#| code-fold: false
#| echo: true
#| warning: false
#| message: false
library(tidyverse)   # datahåndtering, grafikk og glimpse()
library(skimr)       # funksjonen skim() for å se på data
library(rsample)     # for å dele data i training og testing
library(rpart)      # funksjoner for CART
library(rpart.plot) # funksjon for å plotte CART
library(caret)      # inneholder funksjon for confusion matrix
credit <- read.csv("../data/credit.csv", stringsAsFactors = TRUE)
skim(credit)
set.seed(42)
grense <- 0.7
lottery <- runif(n = nrow(credit))
training <- filter(credit, lottery < grense)
testing  <- filter(credit, lottery >= grense)
credit_tree <- rpart(default ~ age + amount + percent_of_income + purpose + employment_duration + housing,
data=training, method="class")
rpart.plot(credit_tree)
training <- initial_split(credit)
testing  <- initial_split(credit)
training <- training(training_init)
training <- train(training_init)
?train
set.seed(42)
training_init <- initial_split(credit)
training <- training(training_init)
testing  <- testing(training_init)
#| eval: true
#| code-fold: false
#| echo: true
#| warning: false
#| message: false
library(tidyverse)   # datahåndtering, grafikk og glimpse()
library(skimr)       # funksjonen skim() for å se på data
library(rsample)     # for å dele data i training og testing
library(pROC)        # Beregne ROC-curve
library(gtsummary)   # Pent formatert regresjonstabell
library(caret)       # Funksjonen confusionMatrix()
#| warning: false
#| message: false
attrition <- readRDS("data/attrition.rds")
skim(attrition)
#| warning: false
#| message: false
attrition <- attrition %>%
select(- EmployeeNumber)
glimpse(attrition)
#| warning: false
#| message: false
set.seed(426)
attrition_split <- initial_split(attrition)
training <- training(attrition_split)
testing  <- testing(attrition_split)
nrow(attrition)
nrow(training)
nrow(testing)
str(training$Attrition)
head(training$Attrition)
levels(training$Attrition)
training$Attrition <- as.numeric(training$Attrition == "Yes")
head(training$Attrition)
mean(training$Attrition)
#| warning: false
#| message: false
training_p <- training %>%
group_by(Age) %>%
summarise(Attrition = mean(Attrition == 1))
ggplot(training_p, aes(x=Age, y=Attrition))+
geom_point()
lm_est <- lm(Attrition ~ Age , data = training)
summary(lm_est)
#| echo: false
library(equatiomatic)
extract_eq(lm_est, use_coefs = TRUE, coef_digits = 3)
#| warning: false
#| message: false
n_data <- data.frame(Age = seq(18, 65))
n_data$pred <- predict(lm_est, newdata = n_data)
ggplot(training_p, aes(x=Age, y=Attrition))+
geom_point()+
geom_line(data =n_data, aes(x = Age, y = pred))
est_logit <- glm(Attrition ~ Age, data = training, family = "binomial")
summary(est_logit)
tbl_regression(est_logit)
#| echo: false
library(equatiomatic)
extract_eq(est_logit, use_coefs = TRUE, coef_digits = 3)
#| warning: false
#| message: false
ggplot(training, aes(x=Age, y=Attrition))+
geom_point(alpha=.3)+
stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE, col="red")
#| warning: false
#| message: false
ggplot(training, aes(x=Age, y=Attrition))+
geom_jitter(height = .02, alpha=.3)+
stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE, col="red")
#| warning: false
#| message: false
training_p <- training %>%
group_by(Age) %>%
summarise(Attrition = mean(Attrition == 1))
ggplot(training_p, aes(x=Age, y=Attrition))+
geom_point()+
stat_smooth(method="glm", method.args=list(family="binomial"), se=FALSE, col="red")
attrition_pred <- training %>%
mutate(prob = predict(est_logit, type = "response"))
ROC <- roc( attrition_pred$Attrition, attrition_pred$prob )
df <- data.frame(Sensitivity = ROC$sensitivities,
Specificity = ROC$specificities)
ggplot(df, aes(y = Sensitivity, x= (1-Specificity))) +
geom_line() +
geom_abline(intercept = 0, slope = 1, col = "gray")+
coord_equal()
est_multlogit <- glm(Attrition ~ ., data = training, family = "binomial")
summary(est_multlogit)
attrition_pred <- training %>%
mutate(prob = predict(est_multlogit, type = "response"))
ROC <- roc(attrition_pred, Attrition, prob)
df <- data.frame(Sensitivity = ROC$sensitivities,
Specificity = ROC$specificities)
ggplot(df, aes(y = Sensitivity, x= (1-Specificity))) +
geom_line() +
geom_abline(intercept = 0, slope = 1, col = "gray")+
coord_equal()
auc(ROC)
attrition_test <- testing %>%
mutate(prob = predict(est_multlogit, newdata = testing, type = "response"))
ROC_test <- roc(attrition_test, Attrition, prob)
df <- data.frame(Sensitivity = ROC_test$sensitivities,
Specificity = ROC_test$specificities)
ggplot(df, aes(y = Sensitivity, x= (1-Specificity))) +
geom_line() +
geom_abline(intercept = 0, slope = 1, col = "gray")+
coord_equal()
auc(ROC_test)
#| message: false
#| warning: false
ggplot(attrition_test, aes(x = prob)) +
geom_histogram()
attrition_test <- attrition_test %>%
mutate(attrition_class = as.factor(ifelse(prob < .5, "No", "Yes")))
tab <- attrition_test %>%
select(Attrition, attrition_class) %>%
table()
tab
confusionMatrix(attrition_test$Attrition, attrition_test$attrition_class, positive = "Yes")
confusionMatrix(reference = attrition_test$Attrition, attrition_test$attrition_class, positive = "Yes")
confusionMatrix(tab)
tab
23/(23+45)
confusionMatrix(tab, positive = "Yes")
confusionMatrix(reference = attrition_test$Attrition, attrition_test$attrition_class, positive = "Yes")
?confusionMatrix
tab <- attrition_test %>%
select(attrition_class, Attrition) %>%
table()
tab
confusionMatrix(tab, positive = "Yes")
confusionMatrix(reference = attrition_test$Attrition, attrition_test$attrition_class, positive = "Yes")
confusionMatrix(tab, positive = "Yes")
tab[2,2]
tab[2,2]
sum(tab[2,])
sum(tab[,2])
(tab[1,2])
tab
