year = Tid,
shj_klienter = KOSsosantkliente0000 ,
shj_unge = KOSant18240000) %>%
select(kommune_nr, year, shj_klienter, shj_unge) %>%
mutate(year = as.numeric(year))
glimpse(shj)
samlet <- left_join(bef_gruppe, hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year"))
samlet <- left_join(bef_gruppe, hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year"))
glimpse(samlet)
glimpse(shj)
samlet <- left_join(bef_gruppe, hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015)
glimpse(samlet)
saveRDS(samlet , "data/kommunedata.rds")
head(bef_gruppe)
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
rename( across(starts_with("bef"), ~ paste0("M_", . )))
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
rename_at( vars(starts_with("bef"), ~ paste0("M_", . )))
?str_replace_all
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
#rename_at( vars(starts_with("bef"), ~ paste0("M_", . )))
rename_all(str_replace_all, "bef", "M_bef")
head(bef_gruppe)
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
#rename_at( vars(starts_with("bef"), ~ paste0("M_", . )))
rename_all(str_replace_all, "bef", "menn_bef")
head(bef_gruppe)
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
rename_all(str_replace_all, "bef", "menn_")
head(bef_menn)
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
rename_all(str_replace_all, "bef_", "menn_")
head(bef_menn)
bef_kvinner <- filter(bef_gruppe, kjonn == "Females") %>%
rename_all(str_replace_all, "bef_", "kvinner_")
head(bef_kvinner)
bef_kvinner <- filter(bef_gruppe, kjonn == "Females") %>%
rename_all(str_replace_all, "bef_", "kvinner_") %>%
select(-kjonn, -kommune)
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
rename_all(str_replace_all, "bef_", "menn_") %>%
select(-kjonn)
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
rename_all(str_replace_all, "bef_", "menn_") %>%
select(-kjonn)
bef_kvinner <- filter(bef_gruppe, kjonn == "Females") %>%
rename_all(str_replace_all, "bef_", "kvinner_") %>%
select(-kjonn, -kommune)
head(bef_kvinner)
samlet <- left_join(bef_menn, bef_kvinner, by = c("kommune_nr", "year")) %>%
left_join(hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015)
glimpse(samlet)
kommune <- saveRDS(samlet , "data/kommunedata.rds")
glimpse(kom_2016)
kommune <- saveRDS(samlet , "data/kommunedata.rds")
glimpse(kommune)
kommune <- saveRDS(samlet , "data/kommunedata.rds")
glimpse(kommune)
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
skim(kommune)
library(skimr)
skim(kommune)
bef_menn <- filter(bef_gruppe, kjonn == "Males") %>%
rename_all(str_replace_all, "bef_", "menn_") %>%
select(-kjonn, -kommune)
bef_kvinner <- filter(bef_gruppe, kjonn == "Females") %>%
rename_all(str_replace_all, "bef_", "kvinner_") %>%
select(-kjonn, -kommune)
samlet <- left_join(bef_gruppe, bef_menn, by = c("kommune_nr", "year")) %>%
left_join(bef_kvinner, by = c("kommune_nr", "year")) %>%
left_join(hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015)
glimpse(samlet)
glimpse(bef_gruppe)
bef_gruppe <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr, kjonn) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
mutate(bef_totalt = rowSums(bef_18_25:bef_18min))
bef_gruppe <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr, kjonn) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
mutate(bef_totalt = rowSums(bef_18_25:bef_18min))
bef_gruppe <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr, kjonn) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
rowwise() %>%
mutate(bef_totalt = rowSums(bef_18_25:bef_18min))
bef_gruppe <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr, kjonn) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
rowwise() %>%
mutate(bef_totalt = sum( across(bef_18_25:bef_18min)))
glimpse(bef_gruppe)
bef_tot <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
rowwise() %>%
mutate(bef_totalt = sum( across(bef_18_25:bef_18min)))
glimpse(bef_tot)
bef_tot <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
rowwise() %>%
mutate(bef_totalt = sum( across(bef_18_25:bef_18min))) %>%
select(1:5, 9)
glimpse(bef_tot)
bef_tot <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
rowwise() %>%
mutate(bef_totalt = sum( across(bef_18_25:bef_18min))) %>%
select(1:5, 8, 9)
glimpse(bef_tot)
bef_tot <- befolkning2 %>%
group_by(kommune_nr, kommune, year, age_gr) %>%
summarise(n = sum(bef_antall)) %>%
ungroup() %>%
pivot_wider(values_from = n, names_from = age_gr) %>%
rename(bef_18_25 = `18-25`, bef_26_35 = `26-35`, bef_36_67 = `36-67`,
bef_67plus = `over 67`, bef_18min = `under 18`) %>%
filter(year >= 2010) %>%
rowwise() %>%
mutate(bef_totalt = sum( across(bef_18_25:bef_18min))) %>%
select(1:3, 8, 4, 5, 9)
glimpse(bef_tot)
samlet <- left_join(bef_tot, bef_menn, by = c("kommune_nr", "year")) %>%
left_join(bef_kvinner, by = c("kommune_nr", "year")) %>%
left_join(hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015)
glimpse(samlet)
saveRDS(samlet , "data/kommunedata.rds")
kommune <- readRDS("data/kommunedata.rds")
glimpse(kommune)
attrition <- readRDS("data/attrition.rds")
attrition <- readRDS("../data/attrition.rds")
load("data/Attrition.Rdata")
glimpse(attrition)
saveRDS(attrition, "data/Attrition.rds")
attrition <- readRDS("data/attrition.rds")
glimpse(attrition)
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = Vold)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
#| warning: false
#| message: false
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
est$r.squared
summary(est)$r.squared
round(summary(est)$r.squared, digits = 2)
kom <- kommune %>%
mutate(pred = predict(est))
summary(est)
predict(est)
kom <- kommune %>%
mutate(pred = predict(est))
kom <- kommune %>%
ungroup() %>%
mutate(pred = predict(est))
#| warning: false
#| message: false
glimpse(kommune)
samlet <- left_join(bef_tot, bef_menn, by = c("kommune_nr", "year")) %>%
left_join(bef_kvinner, by = c("kommune_nr", "year")) %>%
left_join(hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015) %>%
data.frame()
glimpse(samlet)
saveRDS(samlet , "data/kommunedata.rds")
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
skim(kommune)
#| warning: false
#| message: false
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
rmse <- sqrt(mean(est$res^2))
rmse
kom <- kommune %>%
mutate(pred = predict(est))
kom <- kommune %>%
filter(complete.cases()) %>%
mutate(pred = predict(est))
kom <- kommune %>%
filter(!is.na(unge_menn)) %>%
mutate(pred = predict(est))
kom <- kommune %>%
filter(!is.na(prop_unge_menn)) %>%
mutate(pred = predict(est))
#| warning: false
#| message: false
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100) %>%
filter(!is.na(prop_unge_menn))
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
kom <- kommune %>%
mutate(pred = predict(est))
length(predict(est))
dim(kommune)
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100) %>%
filter(!is.na(prop_unge_menn))
dim(kommune)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
#| warning: false
#| message: false
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100) %>%
filter(!is.na(prop_unge_menn), !is.na(voldskriminalitet) )
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
dt <- data.frame(prop_unge_menn = .15)
predict(est, newdata = dt)
predict(est, newdata = dt, interval = "prediction")
kom <- kommune %>%
mutate(pred = predict(est))
ggplot(kom, aes(x = Vold, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
ggplot(kom, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
dt <- data.frame(prop_unge_menn = .15)
predict(est, newdata = dt)
predict(est, newdata = dt, interval = "prediction")
glimpse(kommune)
est_m <- lm(voldskriminalitet ~ prop_unge_menn + inntekt_totalt_median + shj_unge +
ant_husholdninger ,
data=kommune)
summary(est_m)
#| warning: false
#| error: false
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
samlet <- left_join(bef_tot, bef_menn, by = c("kommune_nr", "year")) %>%
left_join(bef_kvinner, by = c("kommune_nr", "year")) %>%
left_join(hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015) %>%
data.frame() %>%
filter(complete.cases())
glimpse(anm)
unique(anm$year)
samlet <- left_join(bef_tot, bef_menn, by = c("kommune_nr", "year")) %>%
left_join(bef_kvinner, by = c("kommune_nr", "year")) %>%
left_join(hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015) %>%
data.frame() %>%
filter(complete.cases(.))
glimpse(samlet)
samlet <- left_join(bef_tot, bef_menn, by = c("kommune_nr", "year")) %>%
left_join(bef_kvinner, by = c("kommune_nr", "year")) %>%
left_join(hh_inntekt, by = c("kommune_nr", "year")) %>%
left_join( shj, by = c("kommune_nr", "year")) %>%
left_join( anm, by = c("kommune_nr", "year")) %>%
filter(year >= 2015) %>%
data.frame() %>%
filter(complete.cases(.))
glimpse(samlet)
saveRDS(samlet , "data/kommunedata.rds")
#| warning: false
#| message: false
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
round(summary(est)$r.squared, digits = 3)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
round(summary(est)$r.squared, digits = 3)
rmse <- sqrt(mean(est$res^2))
rmse
kom <- kommune %>%
mutate(pred = predict(est))
ggplot(kom, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
dt <- data.frame(prop_unge_menn = .15)
predict(est, newdata = dt)
predict(est, newdata = dt, interval = "prediction")
est_m <- lm(voldskriminalitet ~ prop_unge_menn + inntekt_totalt_median + shj_unge +
ant_husholdninger ,
data=kommune)
summary(est_m)
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
est_m <- lm(voldskriminalitet ~ prop_unge_menn + inntekt_totalt_median + shj_unge +
ant_husholdninger ,
data=kommune)
summary(est_m)
summary(kommune$prop_unge_menn)
summary(kommune$shj_unge)
glimpse(samlet)
saveRDS(samlet , "data/kommunedata.rds")
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
round(summary(est_m)$r.squared
round(summary(est_m)$r.squared, digits = 2)
summary(est_m)$r.squared
round(summary(est_m)$r.squared, digits = 2)
#| warning: false
#| error: false
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
kom_s <- kom_2016 %>%
select(-c(kommune, lovb_ialt, Orden,
Rusmiddellovbrudd, Trafikkovertredelse,
lovb_annet, prop_unge_menn))
full_mod <- lm(Vold ~ . , data = kom_s)
summary(full_mod)
full_mod2 <- lm( Vold ~ .^2, data = kom_s)
summary(full_mod2)$r.squared
full_mod3 <- lm( Vold ~ .^3, data = kom_s)
summary(full_mod3)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="backward",
trace = FALSE)
summary(step_mod)$r.squared
#| echo: false
attrition %>%
select(-X) %>%
download_this(
output_name = "attrition dataset",
output_extension = ".csv",
button_label = "Download data as csv",
button_type = "default",
has_icon = TRUE,
icon = "fa fa-save"
)
#| echo: false
attrition %>%
download_this(
output_name = "attrition dataset",
output_extension = ".csv",
button_label = "Download data as csv",
button_type = "default",
has_icon = TRUE,
icon = "fa fa-save"
)
#| warning: false
#| error: false
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
kommune <- readRDS( "data/kommunedata.rds")
glimpse(kommune)
skim(kommune)
#| warning: false
#| message: false
kommune <- kommune %>%
mutate(prop_unge_menn = (menn_18_25 + menn_26_35)/bef_totalt*100)
ggplot(kommune, aes(x = prop_unge_menn,
y = voldskriminalitet)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
est <- lm(voldskriminalitet ~ prop_unge_menn, data=kommune)
summary(est)
round(summary(est)$r.squared, digits = 3)
rmse <- sqrt(mean(est$res^2))
rmse
kom <- kommune %>%
mutate(pred = predict(est))
ggplot(kom, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
dt <- data.frame(prop_unge_menn = .15)
predict(est, newdata = dt)
predict(est, newdata = dt, interval = "prediction")
est_m <- lm(voldskriminalitet ~ prop_unge_menn + inntekt_totalt_median + shj_unge +
ant_husholdninger ,
data=kommune)
summary(est_m)
#| warning: false
#| error: false
kom_pred <- kommune %>%
mutate(pred = predict(est_m))
ggplot(kom_pred, aes(x = voldskriminalitet, y = pred)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE)
kom_s <- kom_2016 %>%
select(-c(kommune, lovb_ialt, Orden,
Rusmiddellovbrudd, Trafikkovertredelse,
lovb_annet, prop_unge_menn))
full_mod <- lm(Vold ~ . , data = kom_s)
summary(full_mod)
full_mod2 <- lm( Vold ~ .^2, data = kom_s)
summary(full_mod2)$r.squared
full_mod3 <- lm( Vold ~ .^3, data = kom_s)
summary(full_mod3)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="backward",
trace = FALSE)
kom_s <- kommune %>%
select(-c(kommune, lovb_ialt, Orden,
Rusmiddellovbrudd, Trafikkovertredelse,
lovb_annet, prop_unge_menn))
glimpse(kommune)
kom_s <- kommune %>%
select(-c(kommune, kommune_nr, ordenslovbrudd,
nark_alko_kriminalitet, trafikklovbrudd, andre_lovbrudd,
prop_unge_menn))
full_mod <- lm(Vold ~ . , data = kom_s)
full_mod <- lm(voldskriminalitet ~ . , data = kom_s)
summary(full_mod)
full_mod2 <- lm( voldskriminalitet ~ .^2, data = kom_s)
summary(full_mod2)$r.squared
full_mod3 <- lm( voldskriminalitet ~ .^3, data = kom_s)
summary(full_mod3)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="backward",
trace = FALSE)
summary(step_mod)$r.squared
step_mod <- MASS::stepAIC(full_mod3, direction="forward",
trace = FALSE)
summary(step_mod)$r.squared
summary(step_mod)
summary(step_mod)$r.squared
kom_pred <- kom_s %>%
mutate(pred = predict(step_mod))
ggplot(kom_pred, aes(x = voldskriminalitet, y = pred)) +
geom_point(alpha = .3) +
geom_smooth(method = "lm", se = FALSE)
kom_s %>%
mutate(pred = predict(step_mod),
residual = pred - voldskriminalitet) %>%
mutate(sq.resid = residual^2) %>%
summarise(sqrt(mean(sq.resid)))
