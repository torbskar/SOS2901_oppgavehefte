<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SOS2901 Maskinlæring for samfunnsvitere - Appendix B — Introduksjon til R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./datasets.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Appendix B — Introduksjon til R</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SOS2901 Maskinlæring for samfunnsvitere</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduksjon</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduksjon.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduksjon til maskinlæring</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_regresjon.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lineær regresjon</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistisk_regresjon.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Logistisk regresjon</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_fairness.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">En lett introduksjon til fairness</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cart.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Klassifikasjonstrær</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bagging.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bagging</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./randomForest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Random forest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fairness.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fairness og tuning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boosting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Boosting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unsupervised.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Unsupervised learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasett</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduksjon_R.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Introduksjon til R</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#hjelp-filer-og-dokumentasjon" id="toc-hjelp-filer-og-dokumentasjon" class="nav-link active" data-scroll-target="#hjelp-filer-og-dokumentasjon"><span class="toc-section-number">B.1</span>  Hjelp-filer og dokumentasjon</a></li>
  <li><a href="#rstudio-projects" id="toc-rstudio-projects" class="nav-link" data-scroll-target="#rstudio-projects"><span class="toc-section-number">B.2</span>  Rstudio projects</a></li>
  <li><a href="#litt-begrepsbruk" id="toc-litt-begrepsbruk" class="nav-link" data-scroll-target="#litt-begrepsbruk"><span class="toc-section-number">B.3</span>  Litt begrepsbruk</a></li>
  <li><a href="#lese-inn-data" id="toc-lese-inn-data" class="nav-link" data-scroll-target="#lese-inn-data"><span class="toc-section-number">B.4</span>  Lese inn data</a></li>
  <li><a href="#variabeltyper" id="toc-variabeltyper" class="nav-link" data-scroll-target="#variabeltyper"><span class="toc-section-number">B.5</span>  Variabeltyper</a></li>
  <li><a href="#dele-et-datasett-i-training-og-testing" id="toc-dele-et-datasett-i-training-og-testing" class="nav-link" data-scroll-target="#dele-et-datasett-i-training-og-testing"><span class="toc-section-number">B.6</span>  Dele et datasett i <em>training</em> og <em>testing</em>?</a></li>
  <li><a href="#seed---gjør-koden-eksakt-reproduserbar" id="toc-seed---gjør-koden-eksakt-reproduserbar" class="nav-link" data-scroll-target="#seed---gjør-koden-eksakt-reproduserbar"><span class="toc-section-number">B.7</span>  Seed - gjør koden eksakt reproduserbar</a></li>
  <li><a href="#prediksjon-med-predict" id="toc-prediksjon-med-predict" class="nav-link" data-scroll-target="#prediksjon-med-predict"><span class="toc-section-number">B.8</span>  Prediksjon med <code>predict()</code></a></li>
  <li><a href="#bruke-formula-for-utfallsvariable-og-prediktorer" id="toc-bruke-formula-for-utfallsvariable-og-prediktorer" class="nav-link" data-scroll-target="#bruke-formula-for-utfallsvariable-og-prediktorer"><span class="toc-section-number">B.9</span>  Bruke <em>formula</em> for utfallsvariable og prediktorer</a></li>
  <li><a href="#databehandling-dplyr-verb-tidyverse" id="toc-databehandling-dplyr-verb-tidyverse" class="nav-link" data-scroll-target="#databehandling-dplyr-verb-tidyverse"><span class="toc-section-number">B.10</span>  Databehandling: dplyr-verb / tidyverse</a>
  <ul class="collapse">
  <li><a href="#hva-gjør-pipe-operatoren" id="toc-hva-gjør-pipe-operatoren" class="nav-link" data-scroll-target="#hva-gjør-pipe-operatoren"><span class="toc-section-number">B.10.1</span>  Hva gjør ‘pipe-operatoren’ <code>%&gt;%</code> ??</a></li>
  </ul></li>
  <li><a href="#grafikk-quickn-dirty-vs-ggplot" id="toc-grafikk-quickn-dirty-vs-ggplot" class="nav-link" data-scroll-target="#grafikk-quickn-dirty-vs-ggplot"><span class="toc-section-number">B.11</span>  Grafikk: quick’n dirty vs ggplot</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">Appendix B — Introduksjon til R</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">

</div>
<p>Dere har noe ulik bakgrunn med R og vil antakeligvis synes forskjellige ting er vanskelig. Her er noen grunnleggende ting for databehandling i R og med lenker der dere kan finne ut mer.</p>
<p>For de av dere som har brukt R en del tidligere kan det hende at det kan være vel så nyttig å se på noen <em>cheatsheets</em> som gir ganske god oversikt. De er nok nyttigst for de som kan en god del fra før, riktignok. Noen slike finnes på <a href="https://posit.co/resources/cheatsheets/">Posit sine hjemmesider</a>, men også <a href="https://www.datacamp.com/cheat-sheet/category/r-programming">DataCamp har noen fine</a> og de kan lastes ned i pdf-format slik at du har dem lett tilgjengelig. Her er noen som kan være mest nyttige:</p>
<ul>
<li><a href="https://www.datacamp.com/cheat-sheet/getting-started-r">Grunnleggende R</a></li>
<li><a href="https://posit.co/wp-content/uploads/2022/10/data-transformation-1.pdf">Datahåndtering med dplyr</a></li>
<li><a href="https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf">Grafikk med ggplot</a></li>
</ul>
<p>Det finnes i det hele tatt voldsomt mange ressurser på nettet for å lære R. Dere skal ikke trenge veldig mye av dette, men noen ganger må man slå opp. Et vanlig nettsøk kan være en bra start.</p>
<section id="hjelp-filer-og-dokumentasjon" class="level2" data-number="B.1">
<h2 data-number="B.1" class="anchored" data-anchor-id="hjelp-filer-og-dokumentasjon"><span class="header-section-number">B.1</span> Hjelp-filer og dokumentasjon</h2>
<p>Alle funksjoner i R har en hjelp-fil som inneholder syntax, forklaring av argumentene, noen detaljer (ved behov), og eksempler. For å få tilgang til denne setter du et spørsmålstegn foran funksjonsnavnet slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>?confusionMatrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Hjelpfilene kan være vanskelige å forstå hvordan fungerer. Det er ikke alltid selvforklarende, for å si det forsiktig. Men det viktige er at du ser hvilke argumenter som hører til funksjonen og hva de betyr. Ofte er det like greit å gå til eksemplene nederst på siden.</p>
</section>
<section id="rstudio-projects" class="level2" data-number="B.2">
<h2 data-number="B.2" class="anchored" data-anchor-id="rstudio-projects"><span class="header-section-number">B.2</span> Rstudio projects</h2>
<p>Det anbefales sterkt å lage en mappestruktur egnet for <em>Rstudio projects</em>. Hensikten med dette er å ha en hensiktsmessig og ryddig mappestruktur for alt arbeidet ditt. Dette er forklart nærmere i <span class="citation" data-cites="r4ds">(<a href="references.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span>, se kapittelet om <a href="https://r4ds.had.co.nz/workflow-projects.html">workflow</a> og særlig <a href="https://r4ds.had.co.nz/workflow-projects.html#rstudio-projects">avsnittet om projects</a>.</p>
<p>Lag en egen mappe for dette kurset og lag følgende undermapper:</p>
<ul>
<li>Data</li>
<li>Script</li>
<li>Output</li>
<li>Dokumenter</li>
</ul>
<p>Du kan også lage andre undermapper hvis du vil. Det vil være begrenset behov for å eksportere output, men det er selvsagt mulig.</p>
</section>
<section id="litt-begrepsbruk" class="level2" data-number="B.3">
<h2 data-number="B.3" class="anchored" data-anchor-id="litt-begrepsbruk"><span class="header-section-number">B.3</span> Litt begrepsbruk</h2>
<p>I R er alt du <strong>gjør</strong> er med <u>funksjoner</u> og alt du gjør noe <strong>med</strong> er <u>objekter</u>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Altså: Alle datasett som leses inn legger du i et <u>objekt</u> og du bruker ulike <u>funksjoner</u> for å estimere modeller. Men du kan også lagre resultater i nye objekter, som f.eks. resultatet av en regresjonsmodell. Objektene kan altså være av forskjellig <em>type</em>, og hvis du lurer på hva slags objekt du har kan du spørre R om det slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dittobjekt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Du gir objektene et navn som du kan referere til senere. Det spiller ingen rolle hva du kaller objektene, men kan ikke ha mellomrom. Bruk navn som gir en viss mening når du jobber med det.</p>
<p>Du kan ha mange objekter i arbeidsminnet i R samtidig. Hvis du bruker et navn som er i bruk fra før, så overskriver du det gamle objektet.</p>
<p><u>Funksjonene</u> har også et navn og etterfølges av en parentes. Inni parentesen angis funksjonens <u>argumenter</u>. Noen slike argumenter er obligatoriske, mens andre er valgfrie. Ofte vil det være forhåndsvalg til en funksjon slik at du ikke behøver å oppgi mer enn et par ting. Et eksempel er å lese inn data med <code>read.csv()</code>, så trenger du bare angi filbanen til datasettet. Denne funksjonen antar at filen er kommaseparert, men hvis det er brukt semikolon kan du angi det med å legge til argumentet <code>sep = ";"</code>.</p>
</section>
<section id="lese-inn-data" class="level2" data-number="B.4">
<h2 data-number="B.4" class="anchored" data-anchor-id="lese-inn-data"><span class="header-section-number">B.4</span> Lese inn data</h2>
<p>Data kommer generelt i mange ulike formater og noen ganger skaper det uforutsette utfordringer med å få data inn i R. I dette kurset er imidlertid dataene i formatene .rds eller .csv.</p>
<p>Alle datasett laster du ned og lagrer i mappen for data (se forrige avsnitt) og leser inn i R derfra. For å lære mer om innlesning av data, se <span class="citation" data-cites="r4ds">(<a href="references.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span> i kapittelet om <a href="https://r4ds.had.co.nz/data-import.html">data import</a>.</p>
<p>Merk at csv-filer er tekstfiler der kollonnene er separert med komma eller semikolon. Hvis dataene ser veldig rare ut etter å lest de inn kan det være fordi det var et annet skilletegn enn du trodde.</p>
<p>csv-filer kan leses inn med funksjonen <code>read.csv()</code> for komma-separerte filer og <code>read.csv2()</code> for semikolon-separerte filer, mens rds-filer leses med <code>readRDS()</code>.</p>
<p>Vær obs på at når man leser inn csv-filer så vil R gjette på hva slags variabeltyper det er. De vil i hovedsak være numeriske, tekst eller factor. I all hovedsak bør tekstvariable tolkes som factor. Dette kan du få til ved å spesifiser det når dataene leses inn slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">"data/navnpaadata.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se mer om factor-variable i neste avsnitt.</p>
</section>
<section id="variabeltyper" class="level2" data-number="B.5">
<h2 data-number="B.5" class="anchored" data-anchor-id="variabeltyper"><span class="header-section-number">B.5</span> Variabeltyper</h2>
<p>Variable kan være av forskjellige typer, primært numerisk eller kategoriske. Numeriske kan igjen være heltall eller lagret med et angitt presisjonsnivå (integer, numeric eller double), men forskjellen mellom disse har i praksis ikke noe å si for vårt bruk her. Datovariable er også numeriske, men vi skal ikke jobbe med datoer her.</p>
<p>Kategoriske variable er ‘string’ (dvs en tekst-streng) eller <em>factor</em>. Du kan lese mer om factor-variable i <span class="citation" data-cites="r4ds">Wickham and Grolemund (<a href="references.html#ref-r4ds" role="doc-biblioref">2017</a>)</span> i <a href="https://r4ds.had.co.nz/factors.html">kapittelet om factor</a>. Kort sagt er factor-variable tekst-variable som har en tilhørende underliggende numerisk verdi som gjør at den kan benyttes i modeller og beregninger.</p>
<p>Et alternativ er å kode om faktorvariable eller tekst-variable til dummy-variable med verdiene 0 eller 1.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
</section>
<section id="dele-et-datasett-i-training-og-testing" class="level2" data-number="B.6">
<h2 data-number="B.6" class="anchored" data-anchor-id="dele-et-datasett-i-training-og-testing"><span class="header-section-number">B.6</span> Dele et datasett i <em>training</em> og <em>testing</em>?</h2>
<p>Vi bruker pakken <em>rsample</em> til å splitte datasettet. Funksjonen <code>initial_split()</code> markerer hvilke observasjoner som er i hvilken del. Så kan du trekke ut disse etterpå med <code>training()</code> og <code>testing()</code>.</p>
</section>
<section id="seed---gjør-koden-eksakt-reproduserbar" class="level2" data-number="B.7">
<h2 data-number="B.7" class="anchored" data-anchor-id="seed---gjør-koden-eksakt-reproduserbar"><span class="header-section-number">B.7</span> Seed - gjør koden eksakt reproduserbar</h2>
<p>En tilfeldig inndeling som med <code>initial_split()</code> bruker tilfeldige tall som genereres av R. Det finnes ikke helt tilfeldige tall i en datamaskin, det bare ser sånn ut. Det er en slags algoritme som generer disse tallen, og det har et startpunkt som varierer med <em>når</em> du setter den igang. Med andre ord: en tilfeldig inndeling vil bli forskjellig hver eneste gang.</p>
<p>Funksjonen <code>set.seed()</code> definerer startpunktet for neste sekvens av tilfeldige tall slik at du kan reprodusere nøyaktig samme resultat. Hvis dere jobber sammen på oppgaver er det en fordel å sette samme seed slik at dere kan sammenligne resultatet.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Dette gjelder for alle funksjoner der det benyttes tilfeldige tall. Det gjelder altså for random forest.</p>
<p>OBS! Vend deg til å alltid bruke set.seed når du jobber i dette kurset, for du kommer til å trenge det på eksamen! Du kan gjøre ting riktig på eksamen likevel, men da blir ikke resultatene reproduserbare og sensor kan ikke sjekke resultatene. (Dere skal få nøyaktige instruksjoner senere).</p>
</section>
<section id="prediksjon-med-predict" class="level2" data-number="B.8">
<h2 data-number="B.8" class="anchored" data-anchor-id="prediksjon-med-predict"><span class="header-section-number">B.8</span> Prediksjon med <code>predict()</code></h2>
<p>Dere skal bruke funksjonen <code>predict()</code> ganske mye. Den tar et objekt fra en eller annen modell og predikerer fra denne. Merk at den bruker det objektet dere har lagret resultatene i, ser hva slags modell det er, og predikerer i henhold til det.</p>
<p>I utgangspunktet bruker den det samme datasettet som modellen ble estimert med. Men kan også predikere på nye data. Da må argumentet <code>newdata = ...</code> angis. Det vil typisk være testing-datasettet eller helt nye observasjoner der du ikke vet utfallet.</p>
<p>Det nye datasettet må alle de variablene som var i det opprinnelige datasettet for at det skal funke. For kategoriske variable vil det også kunne oppstå et problem hvis <em>testing-data</em> inneholdere andre kategorier enn det var i <em>training-data</em>. I slike tilfeller vil man ikke kunne predikere for disse observasjonene, men du vil få prediksjoner for øvrige observasjoner som før.</p>
<p>Man kan predikere forskjellige ting. Det kan være en kontinuerlig verdi, en sannsynlighet eller noe annet. Det kommer an på hva slags modell du estimerte i utgangspunktet. For eksempel vil lineær regresjon kun predikere forventet verdi på den skalaen <span class="math inline">\(y\)</span>-variabel er på. Men for logistisk regresjon kan det predikeres på logit-skala, mens for å få en sannsynlighet må du angi <code>type = response</code>. For random forest vil vi primært bruke en kategorisk utfallsvariabel, og setter da også <code>type = response</code> eller evt <code>type = class</code> (som gir det samme), men det går også an å be om <code>votes</code> eller <code>prob.</code></p>
<p>Til hver type modell finnes det en egen predict-funksjon, og når man bruker <code>predict()</code> så finner den riktig funksjon basert på modelltype. Så hvis du slår opp i hjelp-filen for predict med <code>?predict</code> så står det nesten ingenting. Derimot kan du slå opp i <code>?predict.lm</code> for lineær regresjon, <code>?predict.glm</code> for logistisk regresjon, og tilsvarende <code>?predict.randomForest</code>, <code>?predict.xgb.Booster</code> osv. I utgangspunktet skal du ikke trenge å slå opp disse, men hvis noe går helt galt kan det hende</p>
</section>
<section id="bruke-formula-for-utfallsvariable-og-prediktorer" class="level2" data-number="B.9">
<h2 data-number="B.9" class="anchored" data-anchor-id="bruke-formula-for-utfallsvariable-og-prediktorer"><span class="header-section-number">B.9</span> Bruke <em>formula</em> for utfallsvariable og prediktorer</h2>
<p>De modellen vi skal bruke her angir utfallsvariabel og prediktorer med en <em>formula</em> som angir omtrent slik: <code>utfallsvariabel ~ prediktor1 + prediktor2</code>. Dette tilsvarer altså å skrive <span class="math inline">\(y = x1 + x2\)</span>. For lineær regresjon vil den så estimere de tilhørende regresjonsparametrene <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta_1\)</span> og <span class="math inline">\(\beta_2\)</span>.</p>
<p>For andre modeller der det <em>ikke</em> skal estimeres parametere på samme måte vil man angi variablene på samme måte.</p>
<p>For regresjon kan man angi spesifikasjonen som følger:</p>
<ul>
<li>flere variable: <code>y ~ x + z + k + m</code></li>
<li>inkludere alle variable: <code>y ~ .</code></li>
<li>annengradsledd: <code>y ~ x + I(x^2)</code></li>
<li>tredjegradsledd: <code>y ~ x + I(x^2) + I(x^3)</code></li>
<li>interaksjoner: <code>y ~ x + z + x*z</code></li>
</ul>
<p>Disse kan også kombineres.</p>
</section>
<section id="databehandling-dplyr-verb-tidyverse" class="level2" data-number="B.10">
<h2 data-number="B.10" class="anchored" data-anchor-id="databehandling-dplyr-verb-tidyverse"><span class="header-section-number">B.10</span> Databehandling: dplyr-verb / tidyverse</h2>
<p>Det som kalles <em>tidyverse</em> er en samling R-pakker som til sammen danner et konsistent system for databehandling og grafikk. Hvis du bruker R uten å laste noen pakker, kalles dette <em>base-R</em>. Tidyverse er slik sett en dialekt av R.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p>Databehandling med <em>dplyr</em> (fra tidyverse) har som hovedgrep noen <em>verb</em> som kan settes sammen i lengre uttrykk.</p>
<ul>
<li><code>mutate()</code> brukes til å lage nye variable eller endre på variable</li>
<li><code>filter()</code> brukes til å filtrere data, f.eks. velge ut en undergruppe</li>
<li><code>select()</code> brukes til å velge ut variable - eller velge bort variable</li>
<li><code>summarise()</code> brukes til å summere verdier, f.eks. gjennomsnitt og standardavvik</li>
<li><code>group_by()</code> brukes hvis man skal summere over grupper av observasjoner med <code>summarise()</code> eller <code>mutate()</code>.<br>
</li>
<li><code>arrange()</code> sorterer et datasett</li>
</ul>
<p>Alle disse verbene starter med at man angir hvilket objekt man skal gjøre noe med (dvs datasett) og deretter hva man vil gjøre.<br>
For eksempel kan du lage en ny variabel som er summen av variable med navn X og Y slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>nyedata <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dinedata, <span class="at">sumXY =</span> X <span class="sc">+</span> y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Du kan lese mer om disse verbene i R4DS <span class="citation" data-cites="r4ds">(<a href="references.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span> kapittelet <a href="https://r4ds.had.co.nz/transform.html"><em>Transform</em></a></p>
<p>I dette kurset skal vi ofte lage en ny variabel med <code>predict()</code> og det gjør vi da inni en <code>mutate()</code>, omtrentlig slik:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>endretdata <span class="ot">&lt;-</span> dinedata <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">nyvariabel =</span> <span class="fu">predict</span>(modellobjekt))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Her skal resultatet være et kopi av det opprinnelige datasettet, <em>dinedata</em>, som lages i et nytt objekt <em>endretdata</em>, der den andre linjen legger til en ny variabel som inneholder predikerte verdier fra en modell lagret i <em>modellobjekt</em>.</p>
<section id="hva-gjør-pipe-operatoren" class="level3" data-number="B.10.1">
<h3 data-number="B.10.1" class="anchored" data-anchor-id="hva-gjør-pipe-operatoren"><span class="header-section-number">B.10.1</span> Hva gjør ‘pipe-operatoren’ <code>%&gt;%</code> ??</h3>
<p>Du kan sette sammen flere kombinsjoner av <code>mutate()</code>, <code>select()</code> og andre dplyr-verb med <code>%&gt;%</code>. Les mer om den i R4DS <span class="citation" data-cites="r4ds">(<a href="references.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span> i et eget avsnitt om <a href="https://r4ds.had.co.nz/pipes.html">pipes</a>.</p>
<p>Enkelt sagt tar <code>%&gt;%</code> og legger det som er til <em>venstre</em> over som <em>første</em> argument i neste dplyr-verb. Dermed kan man sette sammen en rekke av dplyr-verb der du både filtrerer, lager nye variable, summerer osv.</p>
</section>
</section>
<section id="grafikk-quickn-dirty-vs-ggplot" class="level2" data-number="B.11">
<h2 data-number="B.11" class="anchored" data-anchor-id="grafikk-quickn-dirty-vs-ggplot"><span class="header-section-number">B.11</span> Grafikk: quick’n dirty vs ggplot</h2>
<p>En rekke modeller har noen standard funksjoner for å plotte. Funksjonen <code>plot()</code> vil kjenne igjen hva slags objekt det er snakk om og så lage en viss type plot. Bruker du dette på et objekt for lineær regresjon får du et annet type plot enn hvis du gjør det på et randomForest-objekt. Dette kan være helt utmerket for en kjapp titt på resultatene, men du har litt mindre kontroll på hva du ber om. Grafikken er ganske pen, men kanskje ikke publiseringsklar.</p>
<p>I en del eksempler her brukes <code>ggplot()</code>. Dette er for avansert grafikk og er det som brukes i standard statistikkurs på bachelornivå på SV-fakultetet (på alle fag, tror jeg). Det er en viktig grunn til at det brukes her også. For en del visualisering av tre-baserte metoder er det vesentlig lettere å bruke spesialiserte funksjoner via <code>plot()</code>. Men for all del: <code>ggplot()</code> kan lage disse figurene også, det bare krever mer arbeid enn vi prioriterer her.</p>
<p>Du kan lære mer om <code>ggplot()</code> i R4DS <span class="citation" data-cites="r4ds">(<a href="references.html#ref-r4ds" role="doc-biblioref">Wickham and Grolemund 2017</a>)</span> i kapittelet om <a href="https://r4ds.had.co.nz/data-visualisation.html">visualisering</a>.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography" style="display: none">
<div id="ref-r4ds" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Garrett Grolemund. 2017. <em>R for Data Science</em>. Beijing, China: <a href="https://r4ds.had.co.nz/index.html" class="uri">https://r4ds.had.co.nz/index.html</a>; O’Reilley.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Man kan si at dette ligner litt på subjekt og verb i vanlige språk.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Dette kalles også noen ganger for <em>indikatorvariable</em> eller <em>one-hot-encoding</em>, litt avhengig av fagfelt og tradisjoner, men er det samme.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Det finnes flere slike <em>dialekter</em> av R, men som ikke er relevant her. Men greit å vite om, særlig hvis man søker på nettet etter hjelp for spesielle problemer. Tidyverse utvikles av firmaet <em>Posit</em> som også lager Rstudio. De leverer også et eget rammeverk for maskinlæring som heter <em>tidymodels</em>, som bl.a. pakken <em>rsample</em> er en del av. Vi holder oss til basis-pakkene for de spesifikke funksjonene på dette kurset.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./datasets.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasett</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb7" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduksjon til R </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>Dere har noe ulik bakgrunn med R og vil antakeligvis synes forskjellige ting er vanskelig. Her er noen grunnleggende ting for databehandling i R og med lenker der dere kan finne ut mer. </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>For de av dere som har brukt R en del tidligere kan det hende at det kan være vel så nyttig å se på noen *cheatsheets* som gir ganske god oversikt. De er nok nyttigst for de som kan en god del fra før, riktignok. Noen slike finnes på <span class="co">[</span><span class="ot">Posit sine hjemmesider</span><span class="co">](https://posit.co/resources/cheatsheets/)</span>, men også <span class="co">[</span><span class="ot">DataCamp har noen fine</span><span class="co">](https://www.datacamp.com/cheat-sheet/category/r-programming)</span> og de kan lastes ned i pdf-format slik at du har dem lett tilgjengelig. Her er noen som kan være mest nyttige: </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Grunnleggende R</span><span class="co">](https://www.datacamp.com/cheat-sheet/getting-started-r)</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Datahåndtering med dplyr</span><span class="co">](https://posit.co/wp-content/uploads/2022/10/data-transformation-1.pdf)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="co">[</span><span class="ot">Grafikk med ggplot</span><span class="co">](https://posit.co/wp-content/uploads/2022/10/data-visualization-1.pdf)</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>Det finnes i det hele tatt voldsomt mange ressurser på nettet for å lære R. Dere skal ikke trenge veldig mye av dette, men noen ganger må man slå opp. Et vanlig nettsøk kan være en bra start. </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hjelp-filer og dokumentasjon</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>Alle funksjoner i R har en hjelp-fil som inneholder syntax, forklaring av argumentene, noen detaljer (ved behov), og eksempler. For å få tilgang til denne setter du et spørsmålstegn foran funksjonsnavnet slik: </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>?confusionMatrix</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>Hjelpfilene kan være vanskelige å forstå hvordan fungerer. Det er ikke alltid selvforklarende, for å si det forsiktig. Men det viktige er at du ser hvilke argumenter som hører til funksjonen og hva de betyr. Ofte er det like greit å gå til eksemplene nederst på siden. </span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rstudio projects </span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>Det anbefales sterkt å lage en mappestruktur egnet for *Rstudio projects*. Hensikten med dette er å ha en hensiktsmessig og ryddig mappestruktur for alt arbeidet ditt. Dette er forklart nærmere i <span class="co">[</span><span class="ot">@r4ds</span><span class="co">]</span>, se kapittelet om <span class="co">[</span><span class="ot">workflow</span><span class="co">](https://r4ds.had.co.nz/workflow-projects.html)</span> og særlig <span class="co">[</span><span class="ot">avsnittet om projects</span><span class="co">](https://r4ds.had.co.nz/workflow-projects.html#rstudio-projects)</span>. </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>Lag en egen mappe for dette kurset og lag følgende undermapper: </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Data</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Script </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Output </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Dokumenter</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>Du kan også lage andre undermapper hvis du vil. Det vil være begrenset behov for å eksportere output, men det er selvsagt mulig. </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Litt begrepsbruk </span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>I R er alt du **gjør** er med &lt;u&gt;funksjoner&lt;/u&gt; og alt du gjør noe **med** er <span class="kw">&lt;u&gt;</span>objekter<span class="kw">&lt;/u&gt;</span>.^<span class="co">[</span><span class="ot">Man kan si at dette ligner litt på subjekt og verb i vanlige språk.</span><span class="co">]</span> </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>Altså: Alle datasett som leses inn legger du i et <span class="kw">&lt;u&gt;</span>objekt<span class="kw">&lt;/u&gt;</span> og du bruker ulike <span class="kw">&lt;u&gt;</span>funksjoner<span class="kw">&lt;/u&gt;</span> for å estimere modeller. Men du kan også lagre resultater i nye objekter, som f.eks. resultatet av en regresjonsmodell. Objektene kan altså være av forskjellig *type*, og hvis du lurer på hva slags objekt du har kan du spørre R om det slik: </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(dittobjekt)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>Du gir objektene et navn som du kan referere til senere. Det spiller ingen rolle hva du kaller objektene, men kan ikke ha mellomrom. Bruk navn som gir en viss mening når du jobber med det. </span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>Du kan ha mange objekter i arbeidsminnet i R samtidig. Hvis du bruker et navn som er i bruk fra før, så overskriver du det gamle objektet. </span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;u&gt;</span>Funksjonene<span class="kw">&lt;/u&gt;</span> har også et navn og etterfølges av en parentes. Inni parentesen angis funksjonens <span class="kw">&lt;u&gt;</span>argumenter<span class="kw">&lt;/u&gt;</span>. Noen slike argumenter er obligatoriske, mens andre er valgfrie. Ofte vil det være forhåndsvalg til en funksjon slik at du ikke behøver å oppgi mer enn et par ting. Et eksempel er å lese inn data med <span class="in">`read.csv()`</span>, så trenger du bare angi filbanen til datasettet. Denne funksjonen antar at filen er kommaseparert, men hvis det er brukt semikolon kan du angi det med å legge til argumentet <span class="in">`sep = ";"`</span>. </span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## Lese inn data</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>Data kommer generelt i mange ulike formater og noen ganger skaper det uforutsette utfordringer med å få data inn i R. I dette kurset er imidlertid dataene i formatene .rds eller .csv. </span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>Alle datasett laster du ned og lagrer i mappen for data (se forrige avsnitt) og leser inn i R derfra. For å lære mer om innlesning av data, se <span class="co">[</span><span class="ot">@r4ds</span><span class="co">]</span> i kapittelet om <span class="co">[</span><span class="ot">data import</span><span class="co">](https://r4ds.had.co.nz/data-import.html)</span>. </span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>Merk at csv-filer er tekstfiler der kollonnene er separert med komma eller semikolon. Hvis dataene ser veldig rare ut etter å lest de inn kan det være fordi det var et annet skilletegn enn du trodde. </span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>csv-filer kan leses inn med funksjonen <span class="in">`read.csv()`</span> for komma-separerte filer og <span class="in">`read.csv2()`</span> for semikolon-separerte filer, mens rds-filer leses med <span class="in">`readRDS()`</span>. </span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>Vær obs på at når man leser inn csv-filer så vil R gjette på hva slags variabeltyper det er. De vil i hovedsak være numeriske, tekst eller factor. I all hovedsak bør tekstvariable tolkes som factor. Dette kan du få til ved å spesifiser det når dataene leses inn slik: </span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">"data/navnpaadata.csv"</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>Se mer om factor-variable i neste avsnitt. </span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a><span class="fu">## Variabeltyper </span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>Variable kan være av forskjellige typer, primært numerisk eller kategoriske. Numeriske kan igjen være heltall eller lagret med et angitt presisjonsnivå (integer, numeric eller double), men forskjellen mellom disse har i praksis ikke noe å si for vårt bruk her. Datovariable er også numeriske, men vi skal ikke jobbe med datoer her. </span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>Kategoriske variable er 'string' (dvs en tekst-streng) eller *factor*. Du kan lese mer om factor-variable i @r4ds i <span class="co">[</span><span class="ot">kapittelet om factor</span><span class="co">](https://r4ds.had.co.nz/factors.html)</span>. Kort sagt er factor-variable tekst-variable som har en tilhørende underliggende numerisk verdi som gjør at den kan benyttes i modeller og beregninger. </span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>Et alternativ er å kode om faktorvariable eller tekst-variable til dummy-variable med verdiene 0 eller 1.^<span class="co">[</span><span class="ot">Dette kalles også noen ganger for *indikatorvariable* eller *one-hot-encoding*, litt avhengig av fagfelt og tradisjoner, men er det samme.</span><span class="co">]</span> </span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dele et datasett i *training* og *testing*? </span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>Vi bruker pakken *rsample* til å splitte datasettet. </span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>Funksjonen <span class="in">`initial_split()`</span> markerer hvilke observasjoner som er i hvilken del. Så kan du trekke ut disse etterpå med <span class="in">`training()`</span>  og <span class="in">`testing()`</span>. </span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a><span class="fu">##  Seed - gjør koden eksakt reproduserbar </span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>En tilfeldig inndeling som med <span class="in">`initial_split()`</span> bruker tilfeldige tall som genereres av R. Det finnes ikke helt tilfeldige tall i en datamaskin, det bare ser sånn ut. Det er en slags algoritme som generer disse tallen, og det har et startpunkt som varierer med *når* du setter den igang. Med andre ord: en tilfeldig inndeling vil bli forskjellig hver eneste gang. </span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>Funksjonen <span class="in">`set.seed()`</span>  definerer startpunktet for neste sekvens av tilfeldige tall slik at du kan reprodusere nøyaktig samme resultat. Hvis dere jobber sammen på oppgaver er det en fordel å sette samme seed slik at dere kan sammenligne resultatet. </span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>Dette gjelder for alle funksjoner der det benyttes tilfeldige tall. Det gjelder altså for random forest. </span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>OBS! Vend deg til å alltid bruke set.seed når du jobber i dette kurset, for du kommer til å trenge det på eksamen! Du kan gjøre ting riktig på eksamen likevel, men da blir ikke resultatene reproduserbare og sensor kan ikke sjekke resultatene. (Dere skal få nøyaktige instruksjoner senere).</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a><span class="fu">## Prediksjon med `predict()`</span></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>Dere skal bruke funksjonen <span class="in">`predict()`</span> ganske mye. Den tar et objekt fra en eller annen modell og predikerer fra denne. Merk at den bruker det objektet dere har lagret resultatene i, ser hva slags modell det er, og predikerer i henhold til det. </span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>I utgangspunktet bruker den det samme datasettet som modellen ble estimert med. Men kan også predikere på nye data. Da må argumentet <span class="in">`newdata = ...`</span> angis. Det vil typisk være testing-datasettet eller helt nye observasjoner der du ikke vet utfallet. </span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>Det nye datasettet må alle de variablene som var i det opprinnelige datasettet for at det skal funke. For kategoriske variable vil det også kunne oppstå et problem hvis *testing-data* inneholdere andre kategorier enn det var i *training-data*. I slike tilfeller vil man ikke kunne predikere for disse observasjonene, men du vil få prediksjoner for øvrige observasjoner som før. </span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>Man kan predikere forskjellige ting. Det kan være en kontinuerlig verdi, en sannsynlighet eller noe annet. Det kommer an på hva slags modell du estimerte i utgangspunktet. For eksempel vil lineær regresjon kun predikere forventet verdi på den skalaen $y$-variabel er på. Men for logistisk regresjon kan det predikeres på logit-skala, mens for å få en sannsynlighet må du angi <span class="in">`type = response`</span>. For random forest vil vi primært bruke en kategorisk utfallsvariabel, og setter da også <span class="in">`type = response`</span> eller evt <span class="in">`type = class`</span> (som gir det samme), men det går også an å be om <span class="in">`votes`</span> eller <span class="in">`prob.`</span> </span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>Til hver type modell finnes det en egen predict-funksjon, og når man bruker <span class="in">`predict()`</span> så finner den riktig funksjon basert på modelltype. Så hvis du slår opp i hjelp-filen for predict med <span class="in">`?predict`</span> så står det nesten ingenting. Derimot kan du slå opp i <span class="in">`?predict.lm`</span> for lineær regresjon, <span class="in">`?predict.glm`</span> for logistisk regresjon, og tilsvarende <span class="in">`?predict.randomForest`</span>, <span class="in">`?predict.xgb.Booster`</span> osv. I utgangspunktet skal du ikke trenge å slå opp disse, men hvis noe går helt galt kan det hende </span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bruke *formula* for utfallsvariable og prediktorer </span></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>De modellen vi skal bruke her angir utfallsvariabel og prediktorer med en *formula* som angir omtrent slik: </span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a><span class="in">`utfallsvariabel ~ prediktor1 + prediktor2`</span>. Dette tilsvarer altså å skrive $y = x1 + x2$. For lineær regresjon vil den så estimere de tilhørende regresjonsparametrene $\alpha$,  $\beta_1$ og $\beta_2$. </span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>For andre modeller der det *ikke* skal estimeres parametere på samme måte vil man angi variablene på samme måte. </span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>For regresjon kan man angi spesifikasjonen som følger: </span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>flere variable: <span class="in">`y ~ x + z + k + m`</span></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>inkludere alle variable: <span class="in">`y ~ .`</span> </span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>annengradsledd: <span class="in">`y ~ x + I(x^2)`</span> </span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>tredjegradsledd: <span class="in">`y ~ x + I(x^2) + I(x^3)`</span> </span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>interaksjoner: <span class="in">`y ~ x + z + x*z`</span> </span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>Disse kan også kombineres. </span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a><span class="fu">## Databehandling: dplyr-verb / tidyverse</span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>Det som kalles *tidyverse* er en samling R-pakker som til sammen danner et konsistent system for databehandling og grafikk. Hvis du bruker R uten å laste noen pakker, kalles dette *base-R*. Tidyverse er slik sett en dialekt av R.^[Det finnes flere slike *dialekter* av R, men som ikke er relevant her. Men greit å vite om, særlig hvis man søker på nettet etter hjelp for spesielle problemer. Tidyverse utvikles av firmaet *Posit* som også lager Rstudio. De leverer også et eget rammeverk for maskinlæring som heter *tidymodels*, som bl.a. pakken *rsample* er en del av. Vi holder oss til basis-pakkene for de spesifikke funksjonene på dette kurset.]</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>Databehandling med *dplyr* (fra tidyverse) har som hovedgrep noen *verb* som kan settes sammen i lengre uttrykk.</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`mutate()`</span> brukes til å lage nye variable eller endre på variable </span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`filter()`</span> brukes til å filtrere data, f.eks. velge ut en undergruppe </span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`select()`</span> brukes til å velge ut variable - eller velge bort variable </span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`summarise()`</span> brukes til å summere verdier, f.eks. gjennomsnitt og standardavvik</span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`group_by()`</span> brukes hvis man skal summere over grupper av observasjoner med <span class="in">`summarise()`</span> eller <span class="in">`mutate()`</span>.  </span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`arrange()`</span> sorterer et datasett </span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>Alle disse verbene starter med at man angir hvilket objekt man skal gjøre noe med (dvs datasett) og deretter hva man vil gjøre.  </span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>For eksempel kan du lage en ny variabel som er summen av variable med navn X og Y slik: </span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a>nyedata <span class="ot">&lt;-</span> <span class="fu">mutate</span>(dinedata, <span class="at">sumXY =</span> X <span class="sc">+</span> y)</span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a>Du kan lese mer om disse verbene i R4DS <span class="co">[</span><span class="ot">@r4ds</span><span class="co">]</span> kapittelet <span class="co">[</span><span class="ot">*Transform*</span><span class="co">](https://r4ds.had.co.nz/transform.html)</span></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>I dette kurset skal vi ofte lage en ny variabel med <span class="in">`predict()`</span> og det gjør vi da inni en <span class="in">`mutate()`</span>, omtrentlig slik: </span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a>endretdata <span class="ot">&lt;-</span> dinedata <span class="sc">%&gt;%</span> </span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">nyvariabel =</span> <span class="fu">predict</span>(modellobjekt))</span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a>Her skal resultatet være et kopi av det opprinnelige datasettet, *dinedata*, som lages i et nytt objekt *endretdata*, der den andre linjen legger til en ny variabel som inneholder predikerte verdier fra en modell lagret i *modellobjekt*. </span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hva gjør 'pipe-operatoren' `%&gt;%` ?? </span></span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a>Du kan sette sammen flere kombinsjoner av <span class="in">`mutate()`</span>, <span class="in">`select()`</span> og andre dplyr-verb med <span class="in">`%&gt;%`</span>. Les mer om den i R4DS <span class="co">[</span><span class="ot">@r4ds</span><span class="co">]</span> i et eget avsnitt om <span class="co">[</span><span class="ot">pipes</span><span class="co">](https://r4ds.had.co.nz/pipes.html)</span>. </span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>Enkelt sagt tar <span class="in">`%&gt;%`</span> og legger det som er til *venstre* over som *første* argument i neste dplyr-verb. Dermed kan man sette sammen en rekke av dplyr-verb der du både filtrerer, lager nye variable, summerer osv. </span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a><span class="fu">## Grafikk: quick'n dirty vs ggplot</span></span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>En rekke modeller har noen standard funksjoner for å plotte. Funksjonen <span class="in">`plot()`</span> vil kjenne igjen hva slags objekt det er snakk om og så lage en viss type plot. Bruker du dette på et objekt for lineær regresjon får du et annet type plot enn hvis du gjør det på et randomForest-objekt. Dette kan være helt utmerket for en kjapp titt på resultatene, men du har litt mindre kontroll på hva du ber om. Grafikken er ganske pen, men kanskje ikke publiseringsklar. </span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>I en del eksempler her brukes <span class="in">`ggplot()`</span>. Dette er for avansert grafikk og er det som brukes i standard statistikkurs på bachelornivå på SV-fakultetet (på alle fag, tror jeg). Det er en viktig grunn til at det brukes her også. For en del visualisering av tre-baserte metoder er det vesentlig lettere å bruke spesialiserte funksjoner via <span class="in">`plot()`</span>. Men for all del: <span class="in">`ggplot()`</span> kan lage disse figurene også, det bare krever mer arbeid enn vi prioriterer her. </span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>Du kan lære mer om <span class="in">`ggplot()`</span> i R4DS <span class="co">[</span><span class="ot">@r4ds</span><span class="co">]</span> i kapittelet om <span class="co">[</span><span class="ot">visualisering</span><span class="co">](https://r4ds.had.co.nz/data-visualisation.html)</span>.</span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>