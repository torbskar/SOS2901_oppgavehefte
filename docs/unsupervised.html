<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SOS2901 Maskinlæring for samfunnsvitere - 10&nbsp; Unsupervised learning</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./boosting.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="site_libs/font-awesome-5.13.0/js/script.js"></script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Unsupervised learning</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SOS2901 Maskinlæring for samfunnsvitere</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Introduksjon</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduksjon.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduksjon til maskinlæring</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./linear_regresjon.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Lineær regresjon</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./logistisk_regresjon.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Logistisk regresjon</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_fairness.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">En lett introduksjon til fairness</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cart.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Klassifikasjonstrær</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./bagging.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bagging</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./randomForest.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Random forest</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fairness.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Fairness og tuning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./boosting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Boosting</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./unsupervised.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Unsupervised learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Datasett</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introduksjon_R.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Introduksjon til R</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#k-means-klustering" id="toc-k-means-klustering" class="nav-link active" data-scroll-target="#k-means-klustering"><span class="toc-section-number">10.1</span>  K-means klustering</a>
  <ul class="collapse">
  <li><a href="#k-means-med-kmeans" id="toc-k-means-med-kmeans" class="nav-link" data-scroll-target="#k-means-med-kmeans"><span class="toc-section-number">10.1.1</span>  K-means med <code>kmeans()</code></a></li>
  <li><a href="#hvor-mange-klustre-trenger-man" id="toc-hvor-mange-klustre-trenger-man" class="nav-link" data-scroll-target="#hvor-mange-klustre-trenger-man"><span class="toc-section-number">10.1.2</span>  Hvor mange klustre trenger man?</a></li>
  <li><a href="#longitudinelle-data" id="toc-longitudinelle-data" class="nav-link" data-scroll-target="#longitudinelle-data"><span class="toc-section-number">10.1.3</span>  Longitudinelle data</a></li>
  </ul></li>
  <li><a href="#hierarkisk-klustering" id="toc-hierarkisk-klustering" class="nav-link" data-scroll-target="#hierarkisk-klustering"><span class="toc-section-number">10.2</span>  Hierarkisk klustering</a></li>
  <li><a href="#datareduksjon-med-principal-component-analysis-pca" id="toc-datareduksjon-med-principal-component-analysis-pca" class="nav-link" data-scroll-target="#datareduksjon-med-principal-component-analysis-pca"><span class="toc-section-number">10.3</span>  Datareduksjon med principal component analysis (PCA)</a>
  <ul class="collapse">
  <li><a href="#multippel-korrespondanseanalyse" id="toc-multippel-korrespondanseanalyse" class="nav-link" data-scroll-target="#multippel-korrespondanseanalyse"><span class="toc-section-number">10.3.1</span>  Multippel korrespondanseanalyse</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Unsupervised learning</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>I dette kapittelt skal vi bruke følgende pakker:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># datahåndtering, grafikk og glimpse()</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)       <span class="co"># funksjonen skim() for å se på data</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)     <span class="co"># for å dele data i training og testing</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>“Usupervised learning” er betegnelsen på en type teknikker der vi ikke har et spesifikt observerbart utfall. (Alle andre teknikker for prediksjon kaller vi derfor “supervised learning”). De teknikkene for unsupervised learning vi skal se på her er vanlige former for klustering og datareduksjon.</p>
<p>Det er to vanlige formål med disse teknikkene:</p>
<ol type="1">
<li>beskrive et stort og komplisert materiale ved å forenkle til noen færre kategorier</li>
<li>lete etter underliggende strukturer i data som ikke er direkte observerbart</li>
<li>pre-prosessering av data før man fortsetter med supervised learning</li>
</ol>
<p>Formål 2) er litt kryptisk, men f.eks. en bedrift kan ha nytte av å dele inn kundemassen i ulike segmenter og rette seg inn mot disse på en systematisk måte.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>For formål 3) gjelder hvis man har veldig mange variable som er korrelerte, men hver for seg ikke er særlig sterke prediktorer. Vanlige prediksjonsmodeller vil ikke alltid være så effektive i slike situasjoner. Forenklede variable som klustre eller principal components kan da fungere bedre. En liten advarsel: man ser litt for ofte at denne typen resultater tolkes litt spekulativt i den forstand at klustre eller principal components tillegges en substansiell betydning. Det hender folk sier at de har “identifisert” underliggende klustre eller dimensjoner etc.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> Men altså: klustermetoder lager klustre. Så teknikken lager klustre uansett, og det er ingen magisk innsikt her utover det. Men det kan være nyttig det, altså!</p>
<section id="k-means-klustering" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="k-means-klustering"><span class="header-section-number">10.1</span> K-means klustering</h2>
<p>Vi starter med et tenkt eksempel der det er to variable og tre klustre, men tilhørighet til kluster er ikke direkte observerbart (altså: det er ingen variable for kluster).</p>
<p>Her ser du de første seks observasjonene i datasettet:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>           x         y
1 -0.7708857  3.821888
2  4.1734709  4.597204
3  0.5497190  8.046265
4 -0.2492836 -1.024751
5 -0.4691657  5.556987
6  3.9338419  6.738554</code></pre>
</div>
</div>
<p>Vi kan så plotte x og y i et scatterplot. I dette tilfellet ser vi tydelig at det er tre klynger av datapunkter. Ofte vil det ikke være så lett å se, men disse dataene er laget slik at det skal være lettere å se hvordan algoritmen fungerer.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I plottet er punktene nå lagt inn tre <em>tilfeldige</em> punkter som marker startpunktet for algoritmen. Disse punktene er <em>tilfeldig</em> valgt, og markerer et første steg som forsøksvis sentrum av tre klustre. Antall klustre må vi altså bestemme selv i forkant.</p>
<p>For hvert av øvrige datapunktene regnes det så avstanden til hvert av disse tre tilfeldige “klustrene”. Hvert datapunkt klassifiseres så til det klusteret de er nærmest.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Etter at hvert datapunkt er klassifisert til det “klusteret” de er nærmest, kan det så regnes det ut midtpunktet for hvert kluster. Dette midtpunktet er så utgangspunktet for neste runde med klassifisering: avstanden fra alle datapunkter til midtpunktet regnes ut og ny klassifisering til det klusteret datapunktet er nærmest.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Etter ny klassifisering, regnes det så ut et nytt midtpunkt og vi gjør det hele en gang til: regner ut avstanden og klassifiserer til nærmeste.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Et nytt midtpunkt regnes ut og vi gjør det hele enda en gang.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Merk nå at i siste runde var det ingen av punktene som byttet kluster. Da avsluttes algoritmen og alle punkter er klassifisert etter hvilket kluster de er mest lik de andre punktene.</p>
<p>I dette eksempelet er klusterne tydelig separert og det er forholdsvis lett å gjøre klassifiseringen. I andre tilfeller er det ikke nødvendigvis like greit, og det må langt flere iterasjoner til før det landes på en løsning.</p>
<p>Det er verd å merke seg at startpunktet (altså de tre tilfeldige punktene) kan ha betydning for løsningen. Det er derfor vanlig at software tester ut flere startverdier og velger den løsningen som passer best.</p>
<section id="k-means-med-kmeans" class="level3" data-number="10.1.1">
<h3 data-number="10.1.1" class="anchored" data-anchor-id="k-means-med-kmeans"><span class="header-section-number">10.1.1</span> K-means med <code>kmeans()</code></h3>
<p>Heldigvis er det en funksjon som fikser hele saken for oss. Funksjonen <code>kmeans()</code> trenger primært tre imput: de dataene som skal klustres, antall klustere, og antall tilfeldige startverdier. Antall klustre må vi altså bestemme selv.</p>
<p>Her er en kode som først kjører kmeans-algoritmen. I det objektet som kommer ut er det en vektor som heter <code>...$cluster</code> som er selve klassifiseringen. Denne kan vi legge inn som en ny variabel i datasettet. Merk at rekkefølgen på observasjonene og output-objektet er den samme, så det blir riktig å bare legge til vektoren som en ny variabel. Dernest kan vi plotte resultatet.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>km_df <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>df_p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> km_df<span class="sc">$</span>cluster)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_p, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y, <span class="at">col =</span> <span class="fu">factor</span>(cluster), <span class="at">shape =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Dette ble selvfølgelig likt som i den trinnvise prosedyren vist ovenfor. Det kan være greit å være klar over at navnet på hvert kluster (1, 2 eller 3) er tilfeldig og du kan få en annen rekkefølge på navnene en annen gang. Det spiller ingen rolle, men er lett å bli forvirret av.</p>
</section>
<section id="hvor-mange-klustre-trenger-man" class="level3" data-number="10.1.2">
<h3 data-number="10.1.2" class="anchored" data-anchor-id="hvor-mange-klustre-trenger-man"><span class="header-section-number">10.1.2</span> Hvor mange klustre trenger man?</h3>
<p>Tja. Hvis du har en god tanke om hvor mange klustre du trenger, så er jo saken grei. Da bruker du disse. Hvis du derimot ikke vet - og det er det vanlige - så kan du gå for det antallet som best oppsummerer dataene. Men hva er så det? Et mål er summen av avstandene til sentrum innenfor hver kluster. Omtales gjerne som “within total sum of squares”. Den løsningen (dvs. antall klustre) som gir lavest kvadratsummer er da den som er “best”.</p>
<p>I praksis betyr det at man tilpasser modellen flere ganger, med trinnvis flere klustre. Så kan man sammenligne “within total sum of squares”.</p>
<p>Den etterfølgende koden gjør dette. Den er litt krøkete, dessverre da den innebærer å skrive en loop.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> Her er i hvert fall full kode.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For 1 to 15 cluster centers</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  km.out <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df, <span class="at">centers =</span> i, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save total within sum of squares to wss variable</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  wss[i] <span class="ot">&lt;-</span> km.out<span class="sc">$</span>tot.withinss</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot total within sum of squares vs. number of clusters</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, wss, <span class="at">type =</span> <span class="st">"b"</span>, </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Number of Clusters"</span>, </span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Within groups sum of squares"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Marker "albuen" med en linje i plottet </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Kvadratsummen reduseres for antall klustre. Intuitivt er jo det rimelig: jo flere klustre - jo kortere er avstanden til et kluster-sentrum. Men merk at trenden flater ganske tydelig ut etter 3 klustre. Altså: forbedringen i tilpassning er minimal. Et slikt plot kalles “elbow method” eller “scree plot”. Beste modell er der hvor kurven får en “albue”, eller med andre ord: der reduksjonen avtar. Det er ikke alltid det er lett å bedømme, men her er det ikke en egentlig fasit. Det finnes ingen fasit hvis man ikke fra før av vet at det finnes et gitt antall klustre.</p>
</section>
<section id="longitudinelle-data" class="level3" data-number="10.1.3">
<h3 data-number="10.1.3" class="anchored" data-anchor-id="longitudinelle-data"><span class="header-section-number">10.1.3</span> Longitudinelle data</h3>
<p>Det er nok vanligst å klustre ulike variable. Men hvis variablene innholder verdier for ulike tidsenheter (f.eks. per år), så kan vi også analysere tidstrender på denne måten. Antall variable som klustres kan være flerdimensjonalt. Ovenfor er det brukt bare to variable, men normale er jo at det er langt flere dimensjoner samtidig.</p>
</section>
</section>
<section id="hierarkisk-klustering" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="hierarkisk-klustering"><span class="header-section-number">10.2</span> Hierarkisk klustering</h2>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 10.1 </strong></span>Last ned filen med kommunedata fra Canvas. Dette er deler av dataene vi brukte i første seminar med kommunetall. Her er det anmeldt kriminalitet per 1000 innbyggere i kommuner i 2016.</p>
<ol type="a">
<li>Gjør en hierarkisk klusteranalsyse. Er det noen kommuner som skiller seg veldig fra de andre? Spiller det noen rolle hvilken type distance du setter?</li>
<li>Hvilke kommuner er de de klusterne som skiller seg ut?</li>
<li>Hva kjennetegner lovbruddsbildet i de ulike klustrene? Kan du tenke deg noen grunner til at akkurat disse stikker seg ut?</li>
</ol>
</div>
<div class="solution proof">
<p><span class="proof-title"><em>Solution</em>. </span>Leser inn data om inntektsutvikling for ulike yrker fra 2001 til 2016</p>
<p>Dataene er i “bred” format. Det er slik vi vil ha det for clusteranalyse, men dårlig for å lage en graf.</p>
<div>
<div class="cell">
<div class="cell-output-display">
<a onclick="fetch('data:application/octet-stream;base64,WAoAAAACAAQCAwACAwAAAAMTAAAAAwAAABAAAAFKAAQACQAAAApNYW5hZ2VtZW50AAQACQAAABNCdXNpbmVzcyBPcGVyYXRpb25zAAQACQAAABBDb21wdXRlciBTY2llbmNlAAQACQAAABhBcmNoaXRlY3R1cmUvRW5naW5lZXJpbmcABAAJAAAAGUxpZmUvUGh5c2ljYWwvU29jaWFsIFNjaS4ABAAJAAAAEkNvbW11bml0eSBTZXJ2aWNlcwAEAAkAAAAFTGVnYWwABAAJAAAAGkVkdWNhdGlvbi9UcmFpbmluZy9MaWJyYXJ5AAQACQAAABlBcnRzL0Rlc2lnbi9FbnRlcnRhaW5tZW50AAQACQAAABhIZWFsdGhjYXJlIFByYWN0aXRpb25lcnMABAAJAAAAEkhlYWx0aGNhcmUgU3VwcG9ydAAEAAkAAAASUHJvdGVjdGl2ZSBTZXJ2aWNlAAQACQAAABBGb29kIFByZXBhcmF0aW9uAAQACQAAABlHcm91bmRzIENsZWFuaW5nICYgTWFpbnQuAAQACQAAAA1QZXJzb25hbCBDYXJlAAQACQAAAAVTYWxlcwAEAAkAAAAVT2ZmaWNlIEFkbWluaXN0cmF0aXZlAAQACQAAABhGYXJtaW5nL0Zpc2hpbmcvRm9yZXN0cnkABAAJAAAADENvbnN0cnVjdGlvbgAEAAkAAAAaSW5zdGFsbGF0aW9uL1JlcGFpci9NYWludC4ABAAJAAAAClByb2R1Y3Rpb24ABAAJAAAAFVRyYW5zcG9ydGF0aW9uL01vdmluZwAEAAkAAAAKTWFuYWdlbWVudAAEAAkAAAATQnVzaW5lc3MgT3BlcmF0aW9ucwAEAAkAAAAQQ29tcHV0ZXIgU2NpZW5jZQAEAAkAAAAYQXJjaGl0ZWN0dXJlL0VuZ2luZWVyaW5nAAQACQAAABlMaWZlL1BoeXNpY2FsL1NvY2lhbCBTY2kuAAQACQAAABJDb21tdW5pdHkgU2VydmljZXMABAAJAAAABUxlZ2FsAAQACQAAABpFZHVjYXRpb24vVHJhaW5pbmcvTGlicmFyeQAEAAkAAAAZQXJ0cy9EZXNpZ24vRW50ZXJ0YWlubWVudAAEAAkAAAAYSGVhbHRoY2FyZSBQcmFjdGl0aW9uZXJzAAQACQAAABJIZWFsdGhjYXJlIFN1cHBvcnQABAAJAAAAElByb3RlY3RpdmUgU2VydmljZQAEAAkAAAAQRm9vZCBQcmVwYXJhdGlvbgAEAAkAAAAZR3JvdW5kcyBDbGVhbmluZyAmIE1haW50LgAEAAkAAAANUGVyc29uYWwgQ2FyZQAEAAkAAAAFU2FsZXMABAAJAAAAFU9mZmljZSBBZG1pbmlzdHJhdGl2ZQAEAAkAAAAYRmFybWluZy9GaXNoaW5nL0ZvcmVzdHJ5AAQACQAAAAxDb25zdHJ1Y3Rpb24ABAAJAAAAGkluc3RhbGxhdGlvbi9SZXBhaXIvTWFpbnQuAAQACQAAAApQcm9kdWN0aW9uAAQACQAAABVUcmFuc3BvcnRhdGlvbi9Nb3ZpbmcABAAJAAAACk1hbmFnZW1lbnQABAAJAAAAE0J1c2luZXNzIE9wZXJhdGlvbnMABAAJAAAAEENvbXB1dGVyIFNjaWVuY2UABAAJAAAAGEFyY2hpdGVjdHVyZS9FbmdpbmVlcmluZwAEAAkAAAAZTGlmZS9QaHlzaWNhbC9Tb2NpYWwgU2NpLgAEAAkAAAASQ29tbXVuaXR5IFNlcnZpY2VzAAQACQAAAAVMZWdhbAAEAAkAAAAaRWR1Y2F0aW9uL1RyYWluaW5nL0xpYnJhcnkABAAJAAAAGUFydHMvRGVzaWduL0VudGVydGFpbm1lbnQABAAJAAAAGEhlYWx0aGNhcmUgUHJhY3RpdGlvbmVycwAEAAkAAAASSGVhbHRoY2FyZSBTdXBwb3J0AAQACQAAABJQcm90ZWN0aXZlIFNlcnZpY2UABAAJAAAAEEZvb2QgUHJlcGFyYXRpb24ABAAJAAAAGUdyb3VuZHMgQ2xlYW5pbmcgJiBNYWludC4ABAAJAAAADVBlcnNvbmFsIENhcmUABAAJAAAABVNhbGVzAAQACQAAABVPZmZpY2UgQWRtaW5pc3RyYXRpdmUABAAJAAAAGEZhcm1pbmcvRmlzaGluZy9Gb3Jlc3RyeQAEAAkAAAAMQ29uc3RydWN0aW9uAAQACQAAABpJbnN0YWxsYXRpb24vUmVwYWlyL01haW50LgAEAAkAAAAKUHJvZHVjdGlvbgAEAAkAAAAVVHJhbnNwb3J0YXRpb24vTW92aW5nAAQACQAAAApNYW5hZ2VtZW50AAQACQAAABNCdXNpbmVzcyBPcGVyYXRpb25zAAQACQAAABBDb21wdXRlciBTY2llbmNlAAQACQAAABhBcmNoaXRlY3R1cmUvRW5naW5lZXJpbmcABAAJAAAAGUxpZmUvUGh5c2ljYWwvU29jaWFsIFNjaS4ABAAJAAAAEkNvbW11bml0eSBTZXJ2aWNlcwAEAAkAAAAFTGVnYWwABAAJAAAAGkVkdWNhdGlvbi9UcmFpbmluZy9MaWJyYXJ5AAQACQAAABlBcnRzL0Rlc2lnbi9FbnRlcnRhaW5tZW50AAQACQAAABhIZWFsdGhjYXJlIFByYWN0aXRpb25lcnMABAAJAAAAEkhlYWx0aGNhcmUgU3VwcG9ydAAEAAkAAAASUHJvdGVjdGl2ZSBTZXJ2aWNlAAQACQAAABBGb29kIFByZXBhcmF0aW9uAAQACQAAABlHcm91bmRzIENsZWFuaW5nICYgTWFpbnQuAAQACQAAAA1QZXJzb25hbCBDYXJlAAQACQAAAAVTYWxlcwAEAAkAAAAVT2ZmaWNlIEFkbWluaXN0cmF0aXZlAAQACQAAABhGYXJtaW5nL0Zpc2hpbmcvRm9yZXN0cnkABAAJAAAADENvbnN0cnVjdGlvbgAEAAkAAAAaSW5zdGFsbGF0aW9uL1JlcGFpci9NYWludC4ABAAJAAAAClByb2R1Y3Rpb24ABAAJAAAAFVRyYW5zcG9ydGF0aW9uL01vdmluZwAEAAkAAAAKTWFuYWdlbWVudAAEAAkAAAATQnVzaW5lc3MgT3BlcmF0aW9ucwAEAAkAAAAQQ29tcHV0ZXIgU2NpZW5jZQAEAAkAAAAYQXJjaGl0ZWN0dXJlL0VuZ2luZWVyaW5nAAQACQAAABlMaWZlL1BoeXNpY2FsL1NvY2lhbCBTY2kuAAQACQAAABJDb21tdW5pdHkgU2VydmljZXMABAAJAAAABUxlZ2FsAAQACQAAABpFZHVjYXRpb24vVHJhaW5pbmcvTGlicmFyeQAEAAkAAAAZQXJ0cy9EZXNpZ24vRW50ZXJ0YWlubWVudAAEAAkAAAAYSGVhbHRoY2FyZSBQcmFjdGl0aW9uZXJzAAQACQAAABJIZWFsdGhjYXJlIFN1cHBvcnQABAAJAAAAElByb3RlY3RpdmUgU2VydmljZQAEAAkAAAAQRm9vZCBQcmVwYXJhdGlvbgAEAAkAAAAZR3JvdW5kcyBDbGVhbmluZyAmIE1haW50LgAEAAkAAAANUGVyc29uYWwgQ2FyZQAEAAkAAAAFU2FsZXMABAAJAAAAFU9mZmljZSBBZG1pbmlzdHJhdGl2ZQAEAAkAAAAYRmFybWluZy9GaXNoaW5nL0ZvcmVzdHJ5AAQACQAAAAxDb25zdHJ1Y3Rpb24ABAAJAAAAGkluc3RhbGxhdGlvbi9SZXBhaXIvTWFpbnQuAAQACQAAAApQcm9kdWN0aW9uAAQACQAAABVUcmFuc3BvcnRhdGlvbi9Nb3ZpbmcABAAJAAAACk1hbmFnZW1lbnQABAAJAAAAE0J1c2luZXNzIE9wZXJhdGlvbnMABAAJAAAAEENvbXB1dGVyIFNjaWVuY2UABAAJAAAAGEFyY2hpdGVjdHVyZS9FbmdpbmVlcmluZwAEAAkAAAAZTGlmZS9QaHlzaWNhbC9Tb2NpYWwgU2NpLgAEAAkAAAASQ29tbXVuaXR5IFNlcnZpY2VzAAQACQAAAAVMZWdhbAAEAAkAAAAaRWR1Y2F0aW9uL1RyYWluaW5nL0xpYnJhcnkABAAJAAAAGUFydHMvRGVzaWduL0VudGVydGFpbm1lbnQABAAJAAAAGEhlYWx0aGNhcmUgUHJhY3RpdGlvbmVycwAEAAkAAAASSGVhbHRoY2FyZSBTdXBwb3J0AAQACQAAABJQcm90ZWN0aXZlIFNlcnZpY2UABAAJAAAAEEZvb2QgUHJlcGFyYXRpb24ABAAJAAAAGUdyb3VuZHMgQ2xlYW5pbmcgJiBNYWludC4ABAAJAAAADVBlcnNvbmFsIENhcmUABAAJAAAABVNhbGVzAAQACQAAABVPZmZpY2UgQWRtaW5pc3RyYXRpdmUABAAJAAAAGEZhcm1pbmcvRmlzaGluZy9Gb3Jlc3RyeQAEAAkAAAAMQ29uc3RydWN0aW9uAAQACQAAABpJbnN0YWxsYXRpb24vUmVwYWlyL01haW50LgAEAAkAAAAKUHJvZHVjdGlvbgAEAAkAAAAVVHJhbnNwb3J0YXRpb24vTW92aW5nAAQACQAAAApNYW5hZ2VtZW50AAQACQAAABNCdXNpbmVzcyBPcGVyYXRpb25zAAQACQAAABBDb21wdXRlciBTY2llbmNlAAQACQAAABhBcmNoaXRlY3R1cmUvRW5naW5lZXJpbmcABAAJAAAAGUxpZmUvUGh5c2ljYWwvU29jaWFsIFNjaS4ABAAJAAAAEkNvbW11bml0eSBTZXJ2aWNlcwAEAAkAAAAFTGVnYWwABAAJAAAAGkVkdWNhdGlvbi9UcmFpbmluZy9MaWJyYXJ5AAQACQAAABlBcnRzL0Rlc2lnbi9FbnRlcnRhaW5tZW50AAQACQAAABhIZWFsdGhjYXJlIFByYWN0aXRpb25lcnMABAAJAAAAEkhlYWx0aGNhcmUgU3VwcG9ydAAEAAkAAAASUHJvdGVjdGl2ZSBTZXJ2aWNlAAQACQAAABBGb29kIFByZXBhcmF0aW9uAAQACQAAABlHcm91bmRzIENsZWFuaW5nICYgTWFpbnQuAAQACQAAAA1QZXJzb25hbCBDYXJlAAQACQAAAAVTYWxlcwAEAAkAAAAVT2ZmaWNlIEFkbWluaXN0cmF0aXZlAAQACQAAABhGYXJtaW5nL0Zpc2hpbmcvRm9yZXN0cnkABAAJAAAADENvbnN0cnVjdGlvbgAEAAkAAAAaSW5zdGFsbGF0aW9uL1JlcGFpci9NYWludC4ABAAJAAAAClByb2R1Y3Rpb24ABAAJAAAAFVRyYW5zcG9ydGF0aW9uL01vdmluZwAEAAkAAAAKTWFuYWdlbWVudAAEAAkAAAATQnVzaW5lc3MgT3BlcmF0aW9ucwAEAAkAAAAQQ29tcHV0ZXIgU2NpZW5jZQAEAAkAAAAYQXJjaGl0ZWN0dXJlL0VuZ2luZWVyaW5nAAQACQAAABlMaWZlL1BoeXNpY2FsL1NvY2lhbCBTY2kuAAQACQAAABJDb21tdW5pdHkgU2VydmljZXMABAAJAAAABUxlZ2FsAAQACQAAABpFZHVjYXRpb24vVHJhaW5pbmcvTGlicmFyeQAEAAkAAAAZQXJ0cy9EZXNpZ24vRW50ZXJ0YWlubWVudAAEAAkAAAAYSGVhbHRoY2FyZSBQcmFjdGl0aW9uZXJzAAQACQAAABJIZWFsdGhjYXJlIFN1cHBvcnQABAAJAAAAElByb3RlY3RpdmUgU2VydmljZQAEAAkAAAAQRm9vZCBQcmVwYXJhdGlvbgAEAAkAAAAZR3JvdW5kcyBDbGVhbmluZyAmIE1haW50LgAEAAkAAAANUGVyc29uYWwgQ2FyZQAEAAkAAAAFU2FsZXMABAAJAAAAFU9mZmljZSBBZG1pbmlzdHJhdGl2ZQAEAAkAAAAYRmFybWluZy9GaXNoaW5nL0ZvcmVzdHJ5AAQACQAAAAxDb25zdHJ1Y3Rpb24ABAAJAAAAGkluc3RhbGxhdGlvbi9SZXBhaXIvTWFpbnQuAAQACQAAAApQcm9kdWN0aW9uAAQACQAAABVUcmFuc3BvcnRhdGlvbi9Nb3ZpbmcABAAJAAAACk1hbmFnZW1lbnQABAAJAAAAE0J1c2luZXNzIE9wZXJhdGlvbnMABAAJAAAAEENvbXB1dGVyIFNjaWVuY2UABAAJAAAAGEFyY2hpdGVjdHVyZS9FbmdpbmVlcmluZwAEAAkAAAAZTGlmZS9QaHlzaWNhbC9Tb2NpYWwgU2NpLgAEAAkAAAASQ29tbXVuaXR5IFNlcnZpY2VzAAQACQAAAAVMZWdhbAAEAAkAAAAaRWR1Y2F0aW9uL1RyYWluaW5nL0xpYnJhcnkABAAJAAAAGUFydHMvRGVzaWduL0VudGVydGFpbm1lbnQABAAJAAAAGEhlYWx0aGNhcmUgUHJhY3RpdGlvbmVycwAEAAkAAAASSGVhbHRoY2FyZSBTdXBwb3J0AAQACQAAABJQcm90ZWN0aXZlIFNlcnZpY2UABAAJAAAAEEZvb2QgUHJlcGFyYXRpb24ABAAJAAAAGUdyb3VuZHMgQ2xlYW5pbmcgJiBNYWludC4ABAAJAAAADVBlcnNvbmFsIENhcmUABAAJAAAABVNhbGVzAAQACQAAABVPZmZpY2UgQWRtaW5pc3RyYXRpdmUABAAJAAAAGEZhcm1pbmcvRmlzaGluZy9Gb3Jlc3RyeQAEAAkAAAAMQ29uc3RydWN0aW9uAAQACQAAABpJbnN0YWxsYXRpb24vUmVwYWlyL01haW50LgAEAAkAAAAKUHJvZHVjdGlvbgAEAAkAAAAVVHJhbnNwb3J0YXRpb24vTW92aW5nAAQACQAAAApNYW5hZ2VtZW50AAQACQAAABNCdXNpbmVzcyBPcGVyYXRpb25zAAQACQAAABBDb21wdXRlciBTY2llbmNlAAQACQAAABhBcmNoaXRlY3R1cmUvRW5naW5lZXJpbmcABAAJAAAAGUxpZmUvUGh5c2ljYWwvU29jaWFsIFNjaS4ABAAJAAAAEkNvbW11bml0eSBTZXJ2aWNlcwAEAAkAAAAFTGVnYWwABAAJAAAAGkVkdWNhdGlvbi9UcmFpbmluZy9MaWJyYXJ5AAQACQAAABlBcnRzL0Rlc2lnbi9FbnRlcnRhaW5tZW50AAQACQAAABhIZWFsdGhjYXJlIFByYWN0aXRpb25lcnMABAAJAAAAEkhlYWx0aGNhcmUgU3VwcG9ydAAEAAkAAAASUHJvdGVjdGl2ZSBTZXJ2aWNlAAQACQAAABBGb29kIFByZXBhcmF0aW9uAAQACQAAABlHcm91bmRzIENsZWFuaW5nICYgTWFpbnQuAAQACQAAAA1QZXJzb25hbCBDYXJlAAQACQAAAAVTYWxlcwAEAAkAAAAVT2ZmaWNlIEFkbWluaXN0cmF0aXZlAAQACQAAABhGYXJtaW5nL0Zpc2hpbmcvRm9yZXN0cnkABAAJAAAADENvbnN0cnVjdGlvbgAEAAkAAAAaSW5zdGFsbGF0aW9uL1JlcGFpci9NYWludC4ABAAJAAAAClByb2R1Y3Rpb24ABAAJAAAAFVRyYW5zcG9ydGF0aW9uL01vdmluZwAEAAkAAAAKTWFuYWdlbWVudAAEAAkAAAATQnVzaW5lc3MgT3BlcmF0aW9ucwAEAAkAAAAQQ29tcHV0ZXIgU2NpZW5jZQAEAAkAAAAYQXJjaGl0ZWN0dXJlL0VuZ2luZWVyaW5nAAQACQAAABlMaWZlL1BoeXNpY2FsL1NvY2lhbCBTY2kuAAQACQAAABJDb21tdW5pdHkgU2VydmljZXMABAAJAAAABUxlZ2FsAAQACQAAABpFZHVjYXRpb24vVHJhaW5pbmcvTGlicmFyeQAEAAkAAAAZQXJ0cy9EZXNpZ24vRW50ZXJ0YWlubWVudAAEAAkAAAAYSGVhbHRoY2FyZSBQcmFjdGl0aW9uZXJzAAQACQAAABJIZWFsdGhjYXJlIFN1cHBvcnQABAAJAAAAElByb3RlY3RpdmUgU2VydmljZQAEAAkAAAAQRm9vZCBQcmVwYXJhdGlvbgAEAAkAAAAZR3JvdW5kcyBDbGVhbmluZyAmIE1haW50LgAEAAkAAAANUGVyc29uYWwgQ2FyZQAEAAkAAAAFU2FsZXMABAAJAAAAFU9mZmljZSBBZG1pbmlzdHJhdGl2ZQAEAAkAAAAYRmFybWluZy9GaXNoaW5nL0ZvcmVzdHJ5AAQACQAAAAxDb25zdHJ1Y3Rpb24ABAAJAAAAGkluc3RhbGxhdGlvbi9SZXBhaXIvTWFpbnQuAAQACQAAAApQcm9kdWN0aW9uAAQACQAAABVUcmFuc3BvcnRhdGlvbi9Nb3ZpbmcABAAJAAAACk1hbmFnZW1lbnQABAAJAAAAE0J1c2luZXNzIE9wZXJhdGlvbnMABAAJAAAAEENvbXB1dGVyIFNjaWVuY2UABAAJAAAAGEFyY2hpdGVjdHVyZS9FbmdpbmVlcmluZwAEAAkAAAAZTGlmZS9QaHlzaWNhbC9Tb2NpYWwgU2NpLgAEAAkAAAASQ29tbXVuaXR5IFNlcnZpY2VzAAQACQAAAAVMZWdhbAAEAAkAAAAaRWR1Y2F0aW9uL1RyYWluaW5nL0xpYnJhcnkABAAJAAAAGUFydHMvRGVzaWduL0VudGVydGFpbm1lbnQABAAJAAAAGEhlYWx0aGNhcmUgUHJhY3RpdGlvbmVycwAEAAkAAAASSGVhbHRoY2FyZSBTdXBwb3J0AAQACQAAABJQcm90ZWN0aXZlIFNlcnZpY2UABAAJAAAAEEZvb2QgUHJlcGFyYXRpb24ABAAJAAAAGUdyb3VuZHMgQ2xlYW5pbmcgJiBNYWludC4ABAAJAAAADVBlcnNvbmFsIENhcmUABAAJAAAABVNhbGVzAAQACQAAABVPZmZpY2UgQWRtaW5pc3RyYXRpdmUABAAJAAAAGEZhcm1pbmcvRmlzaGluZy9Gb3Jlc3RyeQAEAAkAAAAMQ29uc3RydWN0aW9uAAQACQAAABpJbnN0YWxsYXRpb24vUmVwYWlyL01haW50LgAEAAkAAAAKUHJvZHVjdGlvbgAEAAkAAAAVVHJhbnNwb3J0YXRpb24vTW92aW5nAAQACQAAAApNYW5hZ2VtZW50AAQACQAAABNCdXNpbmVzcyBPcGVyYXRpb25zAAQACQAAABBDb21wdXRlciBTY2llbmNlAAQACQAAABhBcmNoaXRlY3R1cmUvRW5naW5lZXJpbmcABAAJAAAAGUxpZmUvUGh5c2ljYWwvU29jaWFsIFNjaS4ABAAJAAAAEkNvbW11bml0eSBTZXJ2aWNlcwAEAAkAAAAFTGVnYWwABAAJAAAAGkVkdWNhdGlvbi9UcmFpbmluZy9MaWJyYXJ5AAQACQAAABlBcnRzL0Rlc2lnbi9FbnRlcnRhaW5tZW50AAQACQAAABhIZWFsdGhjYXJlIFByYWN0aXRpb25lcnMABAAJAAAAEkhlYWx0aGNhcmUgU3VwcG9ydAAEAAkAAAASUHJvdGVjdGl2ZSBTZXJ2aWNlAAQACQAAABBGb29kIFByZXBhcmF0aW9uAAQACQAAABlHcm91bmRzIENsZWFuaW5nICYgTWFpbnQuAAQACQAAAA1QZXJzb25hbCBDYXJlAAQACQAAAAVTYWxlcwAEAAkAAAAVT2ZmaWNlIEFkbWluaXN0cmF0aXZlAAQACQAAABhGYXJtaW5nL0Zpc2hpbmcvRm9yZXN0cnkABAAJAAAADENvbnN0cnVjdGlvbgAEAAkAAAAaSW5zdGFsbGF0aW9uL1JlcGFpci9NYWludC4ABAAJAAAAClByb2R1Y3Rpb24ABAAJAAAAFVRyYW5zcG9ydGF0aW9uL01vdmluZwAEAAkAAAAKTWFuYWdlbWVudAAEAAkAAAATQnVzaW5lc3MgT3BlcmF0aW9ucwAEAAkAAAAQQ29tcHV0ZXIgU2NpZW5jZQAEAAkAAAAYQXJjaGl0ZWN0dXJlL0VuZ2luZWVyaW5nAAQACQAAABlMaWZlL1BoeXNpY2FsL1NvY2lhbCBTY2kuAAQACQAAABJDb21tdW5pdHkgU2VydmljZXMABAAJAAAABUxlZ2FsAAQACQAAABpFZHVjYXRpb24vVHJhaW5pbmcvTGlicmFyeQAEAAkAAAAZQXJ0cy9EZXNpZ24vRW50ZXJ0YWlubWVudAAEAAkAAAAYSGVhbHRoY2FyZSBQcmFjdGl0aW9uZXJzAAQACQAAABJIZWFsdGhjYXJlIFN1cHBvcnQABAAJAAAAElByb3RlY3RpdmUgU2VydmljZQAEAAkAAAAQRm9vZCBQcmVwYXJhdGlvbgAEAAkAAAAZR3JvdW5kcyBDbGVhbmluZyAmIE1haW50LgAEAAkAAAANUGVyc29uYWwgQ2FyZQAEAAkAAAAFU2FsZXMABAAJAAAAFU9mZmljZSBBZG1pbmlzdHJhdGl2ZQAEAAkAAAAYRmFybWluZy9GaXNoaW5nL0ZvcmVzdHJ5AAQACQAAAAxDb25zdHJ1Y3Rpb24ABAAJAAAAGkluc3RhbGxhdGlvbi9SZXBhaXIvTWFpbnQuAAQACQAAAApQcm9kdWN0aW9uAAQACQAAABVUcmFuc3BvcnRhdGlvbi9Nb3ZpbmcABAAJAAAACk1hbmFnZW1lbnQABAAJAAAAE0J1c2luZXNzIE9wZXJhdGlvbnMABAAJAAAAEENvbXB1dGVyIFNjaWVuY2UABAAJAAAAGEFyY2hpdGVjdHVyZS9FbmdpbmVlcmluZwAEAAkAAAAZTGlmZS9QaHlzaWNhbC9Tb2NpYWwgU2NpLgAEAAkAAAASQ29tbXVuaXR5IFNlcnZpY2VzAAQACQAAAAVMZWdhbAAEAAkAAAAaRWR1Y2F0aW9uL1RyYWluaW5nL0xpYnJhcnkABAAJAAAAGUFydHMvRGVzaWduL0VudGVydGFpbm1lbnQABAAJAAAAGEhlYWx0aGNhcmUgUHJhY3RpdGlvbmVycwAEAAkAAAASSGVhbHRoY2FyZSBTdXBwb3J0AAQACQAAABJQcm90ZWN0aXZlIFNlcnZpY2UABAAJAAAAEEZvb2QgUHJlcGFyYXRpb24ABAAJAAAAGUdyb3VuZHMgQ2xlYW5pbmcgJiBNYWludC4ABAAJAAAADVBlcnNvbmFsIENhcmUABAAJAAAABVNhbGVzAAQACQAAABVPZmZpY2UgQWRtaW5pc3RyYXRpdmUABAAJAAAAGEZhcm1pbmcvRmlzaGluZy9Gb3Jlc3RyeQAEAAkAAAAMQ29uc3RydWN0aW9uAAQACQAAABpJbnN0YWxsYXRpb24vUmVwYWlyL01haW50LgAEAAkAAAAKUHJvZHVjdGlvbgAEAAkAAAAVVHJhbnNwb3J0YXRpb24vTW92aW5nAAAAEAAAAUoABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDEABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDIABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDMABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDQABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDUABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDYABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDcABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMDgABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTAABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTEABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTIABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTMABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTQABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTUABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYABAAJAAAABDIwMTYAAAAOAAABSkDxSQAAAAAAQOiygAAAAABA7XfAAAAAAEDrgUAAAAAAQOhFwAAAAABA4LHAAAAAAEDw2mAAAAAAQOMbQAAAAABA42tAAAAAAEDoYUAAAAAAQNVjAAAAAABA38SAAAAAAEDQVAAAAAAAQNPnAAAAAABA1ISAAAAAAEDcPgAAAAAAQNqXgAAAAABA0yuAAAAAAEDhT0AAAAAAQOESAAAAAABA2vQAAAAAAEDZ8AAAAAAAQPNBYAAAAABA6gzAAAAAAEDuF8AAAAAAQOxUgAAAAABA6ZOAAAAAAEDg6MAAAAAAQPLhIAAAAABA45wAAAAAAEDkV4AAAAAAQOpcwAAAAABA1eKAAAAAAEDgRkAAAAAAQNDHAAAAAABA1FyAAAAAAEDU3oAAAAAAQN3kgAAAAABA20GAAAAAAEDTvwAAAAAAQOG+gAAAAABA4XiAAAAAAEDbh4AAAAAAQNqVAAAAAABA9FyAAAAAAEDrWAAAAAAAQO9SwAAAAABA7XzAAAAAAEDq0kAAAAAAQOF7AAAAAABA8y/gAAAAAEDkNcAAAAAAQOUqwAAAAABA63YAAAAAAEDWbAAAAAAAQODPwAAAAABA0P4AAAAAAEDUyoAAAAAAQNUQgAAAAABA3tIAAAAAAEDb3wAAAAAAQNPQgAAAAABA4hEAAAAAAEDh2gAAAAAAQNxAgAAAAABA2vuAAAAAAED1QyAAAAAAQOvkAAAAAABA8DQgAAAAAEDuyoAAAAAAQOwZwAAAAABA4hdAAAAAAEDz0cAAAAAAQOTnQAAAAABA5WWAAAAAAEDseMAAAAAAQNb1gAAAAABA4TUAAAAAAEDRNQAAAAAAQNUpgAAAAABA1ZAAAAAAAEDfhgAAAAAAQNyzgAAAAABA1C+AAAAAAEDigEAAAAAAQOJegAAAAABA3MoAAAAAAEDbloAAAAAAQPWYIAAAAABA7ElAAAAAAEDwYcAAAAAAQO80wAAAAABA7FXAAAAAAEDiU0AAAAAAQPPK4AAAAABA5TdAAAAAAEDlosAAAAAAQOzkQAAAAABA10qAAAAAAEDhdMAAAAAAQNFsAAAAAABA1WqAAAAAAEDVqQAAAAAAQOAEAAAAAABA3QOAAAAAAEDUhIAAAAAAQOKugAAAAABA4pRAAAAAAEDdMIAAAAAAQNwlAAAAAABA9nGgAAAAAEDtTAAAAAAAQPDngAAAAABA8CjgAAAAAEDtIYAAAAAAQOMLAAAAAABA9NcAAAAAAEDmIQAAAAAAQOaDwAAAAABA7knAAAAAAEDYCIAAAAAAQOIWAAAAAABA0f+AAAAAAEDWDQAAAAAAQNZiAAAAAABA4MXAAAAAAEDdqIAAAAAAQNVMgAAAAABA4y9AAAAAAEDjEoAAAAAAQN3EAAAAAABA3MUAAAAAAED3eWAAAAAAQO55QAAAAABA8Z/gAAAAAEDw0QAAAAAAQO5IgAAAAABA48uAAAAAAED1mCAAAAAAQObCQAAAAABA56NAAAAAAEDvv4AAAAAAQNkAAAAAAABA4uvAAAAAAEDS/AAAAAAAQNcCAAAAAABA12sAAAAAAEDhNQAAAAAAQN54AAAAAABA1hwAAAAAAEDj1YAAAAAAQON/QAAAAABA3pOAAAAAAEDd9gAAAAAAQPh9YAAAAABA75oAAAAAAEDyMEAAAAAAQPFwYAAAAABA72MAAAAAAEDkZ8AAAAAAQPaG4AAAAABA56mAAAAAAEDovcAAAAAAQPCTIAAAAABA2bkAAAAAAEDjoQAAAAAAQNO/AAAAAABA18yAAAAAAEDXjgAAAAAAQOGeAAAAAABA33cAAAAAAEDXAgAAAAAAQOStwAAAAABA5CHAAAAAAEDfkAAAAAAAQN62gAAAAABA+b4AAAAAAEDwhqAAAAAAQPLa4AAAAABA8nHgAAAAAEDwNWAAAAAAQOUVgAAAAABA96rAAAAAAEDooQAAAAAAQOmIQAAAAABA8WcAAAAAAEDaSgAAAAAAQOS/QAAAAABA1L4AAAAAAEDYtQAAAAAAQNgDgAAAAABA4fbAAAAAAEDgV8AAAAAAQNfCgAAAAABA5WvAAAAAAEDk50AAAAAAQOB9QAAAAABA3+UAAAAAAED6OSAAAAAAQPDIQAAAAABA8zigAAAAAEDy1AAAAAAAQPB44AAAAABA5WbAAAAAAED4BMAAAAAAQOjWwAAAAABA6ktAAAAAAEDxwaAAAAAAQNq6gAAAAABA5N1AAAAAAEDU7YAAAAAAQNj2AAAAAABA2AsAAAAAAEDiUgAAAAAAQOCpAAAAAABA17sAAAAAAEDlysAAAAAAQOUvwAAAAABA4LWAAAAAAEDgNgAAAAAAQPqBoAAAAABA8PrgAAAAAEDzk0AAAAAAQPNJgAAAAABA8LCAAAAAAEDlmgAAAAAAQPgQoAAAAABA6QFAAAAAAEDqm0AAAAAAQPH0QAAAAABA2yEAAAAAAEDlBUAAAAAAQNThAAAAAABA2RGAAAAAAEDX+YAAAAAAQOKMwAAAAABA4M1AAAAAAEDXqYAAAAAAQOX0AAAAAABA5WvAAAAAAEDg2IAAAAAAQOBmwAAAAABA+v1gAAAAAEDxVsAAAAAAQPQFoAAAAABA845AAAAAAEDw8YAAAAAAQOXUwAAAAABA+FJAAAAAAEDpJYAAAAAAQOsjgAAAAABA8j9AAAAAAEDbowAAAAAAQOU+wAAAAABA1RMAAAAAAEDZZoAAAAAAQNghgAAAAABA4qcAAAAAAEDhCoAAAAAAQNfCgAAAAABA5kfAAAAAAEDlsIAAAAAAQOEOQAAAAABA4IiAAAAAAED7dqAAAAAAQPGtoAAAAABA9IAgAAAAAEDz5wAAAAAAQPEbYAAAAABA5h/AAAAAAED4r2AAAAAAQOl+QAAAAABA6z3AAAAAAEDyjqAAAAAAQNwlAAAAAABA5XmAAAAAAEDVdwAAAAAAQNnAgAAAAABA2GUAAAAAAEDi4IAAAAAAQOFZQAAAAABA2JIAAAAAAEDmwQAAAAAAQOYUgAAAAABA4VRAAAAAAEDg04AAAAAAQPwUwAAAAABA8gSAAAAAAED1CaAAAAAAQPRCQAAAAABA8WNAAAAAAEDmigAAAAAAQPlCQAAAAABA6eEAAAAAAEDr0oAAAAAAQPL+gAAAAABA3NQAAAAAAEDlyEAAAAAAQNZQgAAAAABA2nIAAAAAAEDZDIAAAAAAQOMzAAAAAABA4b1AAAAAAEDZvgAAAAAAQOc7gAAAAABA5nTAAAAAAEDhr4AAAAAAQOErAAAAAABA/NBAAAAAAEDyU+AAAAAAQPV0gAAAAABA9JTAAAAAAEDxziAAAAAAQOcMAAAAAABA+d/AAAAAAEDqnwAAAAAAQOyCwAAAAABA81OAAAAAAEDdwYAAAAAAQOZeQAAAAABA10qAAAAAAEDbWoAAAAAAQNnjgAAAAABA484AAAAAAEDiMYAAAAAAQNsogAAAAABA5+CAAAAAAEDmzEAAAAAAQOIowAAAAABA4ZzAAAAAAAAABAIAAAABAAQACQAAAAlyb3cubmFtZXMAAAANAAAAAoAAAAD///62AAAEAgAAAAEABAAJAAAABW5hbWVzAAAAEAAAAAMABAAJAAAACm9jY3VwYXRpb24ABAAJAAAABHllYXIABAAJAAAAC21lYW5fc2FsYXJ5AAAEAgAAAAEABAAJAAAABWNsYXNzAAAAEAAAAAEABAAJAAAACmRhdGEuZnJhbWUAAAD+').then(res => res.blob()).then(blob => {
      const downloadURL = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      document.body.appendChild(a);
      a.href = downloadURL;
      a.download = 'oes dataset.rds'; a.click();
      window.URL.revokeObjectURL(downloadURL);
      document.body.removeChild(a);
    });">
<button class="btn btn-default" has_icon="TRUE"><i class="fa fa-save"></i> Download data as rds</button>
</a>
</div>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load("../data/oes.RData")</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># gathered_oes &lt;- gather(data = df_oes, </span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                        key = year, </span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                        value = mean_salary, </span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                        -occupation)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_oes, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.numeric</span>(year), <span class="at">y=</span>mean_salary, <span class="at">col =</span> occupation))<span class="sc">+</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dist_oes <span class="ot">&lt;-</span> <span class="fu">dist</span>(df_oes[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">method =</span> <span class="st">"euclidian"</span>) <span class="co"># calculate distances </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>hc_oes <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_oes, <span class="at">method =</span> <span class="st">"single"</span>)  <span class="co"># minste avstand</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>hc_oes <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_oes, <span class="at">method =</span> <span class="st">"complete"</span>) <span class="co"># lengste avstand</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>hc_oes <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_oes, <span class="at">method =</span> <span class="st">"average"</span>) <span class="co">#gjennomsnittlig avstand</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>))  <span class="co"># Endre marginer for base-plot</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>dend_oes <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_oes) <span class="co">#Create a dendrogram object</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>dend_colored <span class="ot">&lt;-</span> <span class="fu">color_branches</span>(dend_oes, <span class="at">h =</span> <span class="dv">100000</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dend_colored)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Illustrer mulige cutoff - legger linjer oppå eksisterende plot</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">100000</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)  <span class="co"># Viser cut ved h=100000</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">10000</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)   <span class="co"># Viser cut ved h=10000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Henter ut cluster ved valgt h</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc_oes, <span class="at">h=</span><span class="dv">100000</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#cluster &lt;- cutree(hc_oes, k=3)</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>cluster
 1  2  3 
 2  5 15 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Legger til vektoren cluster til opprinnelige data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>hclust_oes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df_oes, <span class="at">cluster =</span> cluster)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hclust_oes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                 occupation  2001  2002  2003  2004  2005  2006  2007   2008
1                Management 70800 78870 83400 87090 88450 91930 96150 100310
2       Business Operations 50580 53350 56000 57120 57930 60000 62410  64720
3          Computer Science 60350 61630 64150 66370 67100 69240 72190  74500
4  Architecture/Engineering 56330 58020 60390 63060 63910 66190 68880  71430
5 Life/Physical/Social Sci. 49710 52380 54930 57550 58030 59660 62020  64280
6        Community Services 34190 34630 35800 37050 37530 39000 40540  41790
    2010   2011   2012   2013   2014   2015   2016 cluster
1 105440 107410 108570 110550 112490 115020 118020       1
2  67690  68740  69550  71020  72410  73800  75070       2
3  77230  78730  80180  82010  83970  86170  87880       2
4  75550  77120  79000  80100  81520  82980  84300       2
5  66390  67470  68360  69400  70070  71220  72930       2
6  43180  43830  44240  44710  45310  46160  47200       3</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vrenger dataene "nedover" for å plotte</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>gathered_oes <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> hclust_oes,    <span class="co"># datasett</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">key =</span> year,           <span class="co"># navn på ny variabel, verdier hentes fra gamle variabelnavn</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value =</span> mean_salary,  <span class="co"># navn på ny variabel med gamle variabelverdier</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>occupation, <span class="sc">-</span>cluster) <span class="co"># variable som skal beholdes / grupperes etter</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_oes, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_salary, <span class="at">color =</span> <span class="fu">factor</span>(cluster), <span class="at">group =</span> occupation)) <span class="sc">+</span> </span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div id="exr-" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 10.2 </strong></span>Gjenta analysen over med k-means clustering. Hvor mange klustre bør det være? Får du samme resultat?</p>
</div>
<div class="solution proof">
<div class="cell">
<span class="proof-title"><em>Solution</em>. </span>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">## K-means clustering med samme data </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Eksempel ved å sette antall kluster til 3</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># I dette tilfellet bør vi få samme resultat</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>km_oes <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(dist_oes, <span class="at">centers =</span> <span class="dv">3</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km_oes<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
1 2 3 
8 7 7 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>kmclust_oes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df_oes, <span class="at">cluster=</span>km_oes<span class="sc">$</span>cluster)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotter</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>gathered_kmoes <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> kmclust_oes,    <span class="co"># datasett</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">key =</span> year,           <span class="co"># navn på ny variabel, verdier hentes fra gamle variabelnavn</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value =</span> mean_salary,  <span class="co"># navn på ny variabel med gamle variabelverdier</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>occupation, <span class="sc">-</span>cluster) <span class="co"># variable som skal beholdes / grupperes etter</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_kmoes, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_salary, <span class="at">color =</span> <span class="fu">factor</span>(cluster), <span class="at">group =</span> occupation)) <span class="sc">+</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="do">### K-means clustering. Make a search</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For 1 to 15 cluster centers</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  km.out <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(dist_oes, <span class="at">centers =</span> i, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save total within sum of squares to wss variable</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  wss[i] <span class="ot">&lt;-</span> km.out<span class="sc">$</span>tot.withinss</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot total within sum of squares vs. number of clusters</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, wss, <span class="at">type =</span> <span class="st">"b"</span>, </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Number of Clusters"</span>, </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Within groups sum of squares"</span>)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Marker "albuen" med en linje i plottet </span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-13-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>oes <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../data/oes.rds"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Create final clustering</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>km_oes <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(oes, <span class="at">centers =</span> <span class="dv">2</span>, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km_oes<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 1  2 
 7 15 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>kmclust_oes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df_oes, <span class="at">cluster=</span>km_oes<span class="sc">$</span>cluster)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>gathered_kmoes <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> kmclust_oes,    <span class="co"># datasett</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">key =</span> year,           <span class="co"># navn på ny variabel, verdier hentes fra gamle variabelnavn</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">value =</span> mean_salary,  <span class="co"># navn på ny variabel med gamle variabelverdier</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">-</span>occupation, <span class="sc">-</span>cluster) <span class="co"># variable som skal beholdes / grupperes etter</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_kmoes, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_salary, <span class="at">color =</span> <span class="fu">factor</span>(cluster), <span class="at">group =</span> occupation)) <span class="sc">+</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-13-3.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
</section>
<section id="datareduksjon-med-principal-component-analysis-pca" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="datareduksjon-med-principal-component-analysis-pca"><span class="header-section-number">10.3</span> Datareduksjon med principal component analysis (PCA)</h2>
<p>Vi starter med datasettet for kriminalitet i norske kommuner.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>kommune <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">"data/kommunedata.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(-c(1,3))</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">2</span>, vinningskriminalitet<span class="sc">:</span>andre_lovbrudd) </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(kommune)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 251
Columns: 7
$ kommune                &lt;chr&gt; "Oslo municipality", "Eigersund", "Stavanger", …
$ vinningskriminalitet   &lt;dbl&gt; 31.9, 9.7, 22.3, 21.2, 18.1, 5.0, 6.4, 9.3, 19.…
$ voldskriminalitet      &lt;dbl&gt; 11.0, 3.9, 7.0, 10.3, 6.4, 3.5, 6.5, 4.2, 6.1, …
$ nark_alko_kriminalitet &lt;dbl&gt; 7.0, 6.9, 7.2, 10.7, 6.4, 3.2, 4.1, 5.3, 6.0, 4…
$ ordenslovbrudd         &lt;dbl&gt; 10.8, 4.0, 4.9, 10.0, 4.6, 3.5, 3.3, 3.6, 5.0, …
$ trafikklovbrudd        &lt;dbl&gt; 6.7, 10.2, 5.2, 5.6, 6.8, 5.0, 6.3, 7.1, 6.5, 6…
$ andre_lovbrudd         &lt;dbl&gt; 18.3, 9.2, 11.5, 12.7, 9.2, 6.3, 8.7, 9.2, 13.4…</code></pre>
</div>
</div>
<p>Så et lite triks som ikke er viktig for resultatet som sådan, men hjelper å holde orden på dataene. Vi er kjent med at kolonnene i et datasett har navn: altså variabelnavn. Men i R kan også <em>radene</em> ha navn. Det er ikke like vanlig å bruke til noe spesielt, men her er det nyttig å ta det med seg.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(kommune) <span class="ot">&lt;-</span> kommune[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Så kan vi kjøre en principal component analyse. Det er her viktig å sette <code>scale = TRUE</code>. Dette gjør at dataene re-skaleres til en z-skår med gjennomsnitt 0 og standardavvik 1. Det skal veldig gode grunner for å gjøre noe annet, så gjør alltid dette.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>pr_komm <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(kommune[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">center =</span> <span class="cn">TRUE</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pr_komm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Importance of components:
                          PC1    PC2    PC3     PC4     PC5     PC6
Standard deviation     1.7710 1.1142 0.7933 0.70871 0.52972 0.45832
Proportion of Variance 0.5227 0.2069 0.1049 0.08371 0.04677 0.03501
Cumulative Proportion  0.5227 0.7296 0.8345 0.91822 0.96499 1.00000</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(kommune<span class="sc">$</span>vinningskriminalitet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.896016</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>pr_komm<span class="sc">$</span>center</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  vinningskriminalitet      voldskriminalitet nark_alko_kriminalitet 
              7.896016               5.472908               5.596813 
        ordenslovbrudd        trafikklovbrudd         andre_lovbrudd 
              4.344223               9.896414               9.712749 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pvar <span class="ot">&lt;-</span> pr_komm<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>pve <span class="ot">&lt;-</span> pvar<span class="sc">/</span><span class="fu">sum</span>(pvar)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, pve, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">components =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pve), <span class="at">prop_var_expl =</span> pve)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dt, <span class="fu">aes</span>(<span class="at">x =</span> components, <span class="at">y =</span> prop_var_expl))<span class="sc">+</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Da kan resultatene vises grafisk som følger.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(pr_komm, <span class="at">cex =</span> .<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="unsupervised_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>kommune_scale <span class="ot">&lt;-</span> kommune <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), scale)) </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(kommune_scale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 251
Columns: 7
$ kommune                &lt;chr&gt; "Oslo municipality", "Eigersund", "Stavanger", …
$ vinningskriminalitet   &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;
$ voldskriminalitet      &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;
$ nark_alko_kriminalitet &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;
$ ordenslovbrudd         &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;
$ trafikklovbrudd        &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;
$ andre_lovbrudd         &lt;dbl[,1]&gt; &lt;matrix[26 x 1]&gt;</code></pre>
</div>
</div>
<div class="cell">

</div>
<section id="multippel-korrespondanseanalyse" class="level3" data-number="10.3.1">
<h3 data-number="10.3.1" class="anchored" data-anchor-id="multippel-korrespondanseanalyse"><span class="header-section-number">10.3.1</span> Multippel korrespondanseanalyse</h3>
<p>PCA har egentlig som forutsetning av variablene er kontinuerlige, og det er litt trøblete å bruke det på kategoriske variable. Men ofte har vi kategoriske variable.</p>
<p>En variant av PCA for kategoriske variable er korrespondanseanalyse, som i teorien altså skal være bedre enn PCA. I praksis er det imidlertid ikke nødvendigvis veldig stor forskjell, så det er neppe stor skade skjedd hvis man bruker PCA likevel.</p>


<!-- -->

</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>OBS! Det spiller ingen rolle om disse gruppene er reelle som gruppe eller ikke. At de oppfører seg rimelig likt holder til formålet.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Av høflighetsgrunner er referanser til eksempler utelatt. Men det er ikke vanskelig å finne. Eksemplene er heller ikke avgrenset til akkurat disse metodene, men gjelder også en rekke andre teknikker med tilsvarende formål.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Det er muligens greit for de av dere som har lært en god del R tidligere. Ikke like greit for dere andre. <a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./boosting.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Boosting</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu"># Unsupervised learning </span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>I dette kapittelt skal vi bruke følgende pakker: </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false </span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># datahåndtering, grafikk og glimpse()</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)       <span class="co"># funksjonen skim() for å se på data</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)     <span class="co"># for å dele data i training og testing</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend)</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(directlabels)</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>"Usupervised learning" er betegnelsen på en type teknikker der vi ikke har et spesifikt observerbart utfall. (Alle andre teknikker for prediksjon kaller vi derfor "supervised learning"). De teknikkene for unsupervised learning vi skal se på her er vanlige former for klustering og datareduksjon. </span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>Det er to vanlige formål med disse teknikkene: </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>1) beskrive et stort og komplisert materiale ved å forenkle til noen færre kategorier </span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>2) lete etter underliggende strukturer i data som ikke er direkte observerbart </span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>3) pre-prosessering av data før man fortsetter med supervised learning</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>Formål 2) er litt kryptisk, men f.eks. en bedrift kan ha nytte av å dele inn kundemassen i ulike segmenter og rette seg inn mot disse på en systematisk måte.^<span class="co">[</span><span class="ot">OBS! Det spiller ingen rolle om disse gruppene er reelle som gruppe eller ikke. At de oppfører seg rimelig likt holder til formålet.</span><span class="co">]</span> </span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>For formål 3) gjelder hvis man har veldig mange variable som er korrelerte, men hver for seg ikke er særlig sterke prediktorer. Vanlige prediksjonsmodeller vil ikke alltid være så effektive i slike situasjoner. Forenklede variable som klustre eller principal components kan da fungere bedre. </span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>En liten advarsel: man ser litt for ofte at denne typen resultater tolkes litt spekulativt i den forstand at klustre eller principal components tillegges en substansiell betydning. Det hender folk sier at de har "identifisert" underliggende klustre eller dimensjoner etc.^<span class="co">[</span><span class="ot">Av høflighetsgrunner er referanser til eksempler utelatt. Men det er ikke vanskelig å finne. Eksemplene er heller ikke avgrenset til akkurat disse metodene, men gjelder også en rekke andre teknikker med tilsvarende formål.</span><span class="co">]</span> Men altså: klustermetoder lager klustre. Så teknikken lager klustre uansett, og det er ingen magisk innsikt her utover det. Men det kan være nyttig det, altså! </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="fu">## K-means klustering </span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>Vi starter med et tenkt eksempel der det er to variable og tre klustre, men tilhørighet til kluster er ikke direkte observerbart (altså: det er ingen variable for kluster). </span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>Her ser du de første seks observasjonene i datasettet:</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">70</span>)</span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">sd=</span>.<span class="dv">5</span>) <span class="sc">+</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, .<span class="dv">4</span>)<span class="sc">*</span><span class="dv">4</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n)<span class="sc">+</span> <span class="fu">ifelse</span>(x<span class="sc">&lt;=</span><span class="dv">2</span>, <span class="fu">rbinom</span>(n, <span class="dv">1</span>, .<span class="dv">5</span>)<span class="sc">*</span><span class="dv">6</span>, <span class="dv">0</span>)</span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>Vi kan så plotte x og y i et scatterplot. I dette tilfellet ser vi tydelig at det er tre klynger av datapunkter. Ofte vil det ikke være så lett å se, men disse dataene er laget slik at det skal være lettere å se hvordan algoritmen fungerer. </span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>grps <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">58</span>)</span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ran =</span> <span class="fu">runif</span>(<span class="fu">dim</span>(.)[<span class="dv">1</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ran) <span class="sc">%&gt;%</span> </span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>grps) <span class="sc">%&gt;%</span> </span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y)</span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb34-78"><a href="#cb34-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-79"><a href="#cb34-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> start, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a>I plottet er punktene nå lagt inn tre *tilfeldige* punkter som marker startpunktet for algoritmen. Disse punktene er *tilfeldig* valgt, og markerer et første steg som forsøksvis sentrum av tre klustre. Antall klustre må vi altså bestemme selv i forkant. </span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a>For hvert av øvrige datapunktene regnes det så avstanden til hvert av disse tre tilfeldige "klustrene". Hvert datapunkt klassifiseres så til det klusteret de er nærmest. </span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">grp1 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp2 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp3 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> )) </span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df,  d) <span class="sc">%&gt;%</span></span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">min</span>(<span class="fu">c_across</span>(grp1<span class="sc">:</span>grp3))) <span class="sc">%&gt;%</span></span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(grp1 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>                           grp2 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>                           grp3 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y, id, group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_c =</span> <span class="fu">mean</span>(y), <span class="at">x_c =</span> <span class="fu">mean</span>(x))  </span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df1, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y, <span class="at">col =</span> <span class="fu">factor</span>(group), <span class="at">shape =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x_c, <span class="at">y =</span> y_c), <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a>Etter at hvert datapunkt er klassifisert til det "klusteret" de er nærmest, kan det så regnes det ut midtpunktet for hvert kluster. Dette midtpunktet er så utgangspunktet for neste runde med klassifisering: avstanden fra alle datapunkter til midtpunktet regnes ut og ny klassifisering til det klusteret datapunktet er nærmest. </span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> df1 <span class="sc">%&gt;%</span></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">x =</span> <span class="fu">mean</span>(x), <span class="at">y =</span> <span class="fu">mean</span>(y)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y) </span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">grp1 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp2 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp3 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> )) </span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df1[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],  d) <span class="sc">%&gt;%</span> </span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> df1<span class="sc">$</span>group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span>  </span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">min</span>(<span class="fu">c</span>(grp1, grp2, grp3))) <span class="sc">%&gt;%</span></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(grp1 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a>                           grp2 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a>                           grp3 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_c =</span> <span class="fu">mean</span>(y), <span class="at">x_c =</span> <span class="fu">mean</span>(x))</span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y, <span class="at">col =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x_c, <span class="at">y =</span> y_c), <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a>Etter ny klassifisering, regnes det så ut et nytt midtpunkt og vi gjør det hele en gang til: regner ut avstanden og klassifiserer til nærmeste.  </span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> df2 <span class="sc">%&gt;%</span></span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">x =</span> <span class="fu">mean</span>(x), <span class="at">y =</span> <span class="fu">mean</span>(y)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y) </span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">grp1 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp2 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp3 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> )) </span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df2[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],  d) <span class="sc">%&gt;%</span> </span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> df2<span class="sc">$</span>group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span>  </span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">min</span>(<span class="fu">c</span>(grp1, grp2, grp3))) <span class="sc">%&gt;%</span></span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(grp1 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>                           grp2 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a>                           grp3 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_c =</span> <span class="fu">mean</span>(y), <span class="at">x_c =</span> <span class="fu">mean</span>(x))</span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df3, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y, <span class="at">col =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x_c, <span class="at">y =</span> y_c), <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb34-195"><a href="#cb34-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a>Et nytt midtpunkt regnes ut og vi gjør det hele enda en gang.</span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-203"><a href="#cb34-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a>start <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span></span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">x =</span> <span class="fu">mean</span>(x), <span class="at">y =</span> <span class="fu">mean</span>(y)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y) </span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">grp1 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">1</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-212"><a href="#cb34-212" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp2 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">2</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> ),</span>
<span id="cb34-213"><a href="#cb34-213" aria-hidden="true" tabindex="-1"></a>                <span class="at">grp3 =</span> <span class="fu">sqrt</span>( (x<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>x)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (y<span class="sc">-</span>start[<span class="dv">3</span>,]<span class="sc">$</span>y)<span class="sc">^</span><span class="dv">2</span> )) </span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a>df4 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df3[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>],  d) <span class="sc">%&gt;%</span> </span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> df3<span class="sc">$</span>group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span>  </span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">min</span>(<span class="fu">c</span>(grp1, grp2, grp3))) <span class="sc">%&gt;%</span></span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">case_when</span>(grp1 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb34-222"><a href="#cb34-222" aria-hidden="true" tabindex="-1"></a>                           grp2 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb34-223"><a href="#cb34-223" aria-hidden="true" tabindex="-1"></a>                           grp3 <span class="sc">==</span> min <span class="sc">~</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-224"><a href="#cb34-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb34-225"><a href="#cb34-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y_c =</span> <span class="fu">mean</span>(y), <span class="at">x_c =</span> <span class="fu">mean</span>(x))</span>
<span id="cb34-226"><a href="#cb34-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-227"><a href="#cb34-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-228"><a href="#cb34-228" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df4, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y, <span class="at">col =</span> <span class="fu">factor</span>(group))) <span class="sc">+</span></span>
<span id="cb34-229"><a href="#cb34-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-230"><a href="#cb34-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb34-231"><a href="#cb34-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>x_c, <span class="at">y =</span> y_c), <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb34-232"><a href="#cb34-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb34-233"><a href="#cb34-233" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb34-234"><a href="#cb34-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-235"><a href="#cb34-235" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-236"><a href="#cb34-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-237"><a href="#cb34-237" aria-hidden="true" tabindex="-1"></a>Merk nå at i siste runde var det ingen av punktene som byttet kluster. Da avsluttes algoritmen og alle punkter er klassifisert etter hvilket kluster de er mest lik de andre punktene. </span>
<span id="cb34-238"><a href="#cb34-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-239"><a href="#cb34-239" aria-hidden="true" tabindex="-1"></a>I dette eksempelet er klusterne tydelig separert og det er forholdsvis lett å gjøre klassifiseringen. I andre tilfeller er det ikke nødvendigvis like greit, og det må langt flere iterasjoner til før det landes på en løsning. </span>
<span id="cb34-240"><a href="#cb34-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-241"><a href="#cb34-241" aria-hidden="true" tabindex="-1"></a>Det er verd å merke seg at startpunktet (altså de tre tilfeldige punktene) kan ha betydning for løsningen. Det er derfor vanlig at software tester ut flere startverdier og velger den løsningen som passer best. </span>
<span id="cb34-242"><a href="#cb34-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-243"><a href="#cb34-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-244"><a href="#cb34-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-245"><a href="#cb34-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-246"><a href="#cb34-246" aria-hidden="true" tabindex="-1"></a><span class="fu">### K-means med `kmeans()` </span></span>
<span id="cb34-247"><a href="#cb34-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-248"><a href="#cb34-248" aria-hidden="true" tabindex="-1"></a>Heldigvis er det en funksjon som fikser hele saken for oss. Funksjonen <span class="in">`kmeans()`</span> trenger primært tre imput: de dataene som skal klustres, antall klustere, og antall tilfeldige startverdier. Antall klustre må vi altså bestemme selv. </span>
<span id="cb34-249"><a href="#cb34-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-250"><a href="#cb34-250" aria-hidden="true" tabindex="-1"></a>Her er en kode som først kjører kmeans-algoritmen. I det objektet som kommer ut er det en vektor som heter <span class="in">`...$cluster`</span> som er selve klassifiseringen. Denne kan vi legge inn som en ny variabel i datasettet. Merk at rekkefølgen på observasjonene og output-objektet er den samme, så det blir riktig å bare legge til vektoren som en ny variabel. Dernest kan vi plotte resultatet. </span>
<span id="cb34-251"><a href="#cb34-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-254"><a href="#cb34-254" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-255"><a href="#cb34-255" aria-hidden="true" tabindex="-1"></a>km_df <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb34-256"><a href="#cb34-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-257"><a href="#cb34-257" aria-hidden="true" tabindex="-1"></a>df_p <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb34-258"><a href="#cb34-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> km_df<span class="sc">$</span>cluster)</span>
<span id="cb34-259"><a href="#cb34-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-260"><a href="#cb34-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-261"><a href="#cb34-261" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_p, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> y, <span class="at">col =</span> <span class="fu">factor</span>(cluster), <span class="at">shape =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb34-262"><a href="#cb34-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb34-263"><a href="#cb34-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-264"><a href="#cb34-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-265"><a href="#cb34-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-266"><a href="#cb34-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-267"><a href="#cb34-267" aria-hidden="true" tabindex="-1"></a>Dette ble selvfølgelig likt som i den trinnvise prosedyren vist ovenfor. Det kan være greit å være klar over at navnet på hvert kluster (1, 2 eller 3) er tilfeldig og du kan få en annen rekkefølge på navnene en annen gang. Det spiller ingen rolle, men er lett å bli forvirret av. </span>
<span id="cb34-268"><a href="#cb34-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-269"><a href="#cb34-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-270"><a href="#cb34-270" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hvor mange klustre trenger man? </span></span>
<span id="cb34-271"><a href="#cb34-271" aria-hidden="true" tabindex="-1"></a>Tja. Hvis du har en god tanke om hvor mange klustre du trenger, så er jo saken grei. Da bruker du disse. Hvis du derimot ikke vet - og det er det vanlige - så kan du gå for det antallet som best oppsummerer dataene. Men hva er så det? Et mål er summen av avstandene til sentrum innenfor hver kluster. Omtales gjerne som "within total sum of squares". Den løsningen (dvs. antall klustre) som gir lavest kvadratsummer er da den som er "best". </span>
<span id="cb34-272"><a href="#cb34-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-273"><a href="#cb34-273" aria-hidden="true" tabindex="-1"></a>I praksis betyr det at man tilpasser modellen flere ganger, med trinnvis flere klustre. Så kan man sammenligne "within total sum of squares". </span>
<span id="cb34-274"><a href="#cb34-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-275"><a href="#cb34-275" aria-hidden="true" tabindex="-1"></a>Den etterfølgende koden gjør dette. Den er litt krøkete, dessverre da den innebærer å skrive en loop.^<span class="co">[</span><span class="ot">Det er muligens greit for de av dere som har lært en god del R tidligere. Ikke like greit for dere andre. </span><span class="co">]</span> Her er i hvert fall full kode. </span>
<span id="cb34-276"><a href="#cb34-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-279"><a href="#cb34-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-280"><a href="#cb34-280" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-281"><a href="#cb34-281" aria-hidden="true" tabindex="-1"></a><span class="co"># For 1 to 15 cluster centers</span></span>
<span id="cb34-282"><a href="#cb34-282" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb34-283"><a href="#cb34-283" aria-hidden="true" tabindex="-1"></a>  km.out <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(df, <span class="at">centers =</span> i, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb34-284"><a href="#cb34-284" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save total within sum of squares to wss variable</span></span>
<span id="cb34-285"><a href="#cb34-285" aria-hidden="true" tabindex="-1"></a>  wss[i] <span class="ot">&lt;-</span> km.out<span class="sc">$</span>tot.withinss</span>
<span id="cb34-286"><a href="#cb34-286" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-287"><a href="#cb34-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-288"><a href="#cb34-288" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot total within sum of squares vs. number of clusters</span></span>
<span id="cb34-289"><a href="#cb34-289" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, wss, <span class="at">type =</span> <span class="st">"b"</span>, </span>
<span id="cb34-290"><a href="#cb34-290" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Number of Clusters"</span>, </span>
<span id="cb34-291"><a href="#cb34-291" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Within groups sum of squares"</span>)</span>
<span id="cb34-292"><a href="#cb34-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Marker "albuen" med en linje i plottet </span></span>
<span id="cb34-293"><a href="#cb34-293" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb34-294"><a href="#cb34-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-295"><a href="#cb34-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-296"><a href="#cb34-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-297"><a href="#cb34-297" aria-hidden="true" tabindex="-1"></a>Kvadratsummen reduseres for antall klustre. Intuitivt er jo det rimelig: jo flere klustre - jo kortere er avstanden til et kluster-sentrum. Men merk at trenden flater ganske tydelig ut etter 3 klustre. Altså: forbedringen i tilpassning er minimal. Et slikt plot kalles "elbow method" eller "scree plot". Beste modell er der hvor kurven får en "albue", eller med andre ord: der reduksjonen avtar. Det er ikke alltid det er lett å bedømme, men her er det ikke en egentlig fasit. Det finnes ingen fasit hvis man ikke fra før av vet at det finnes et gitt antall klustre. </span>
<span id="cb34-298"><a href="#cb34-298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-299"><a href="#cb34-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-300"><a href="#cb34-300" aria-hidden="true" tabindex="-1"></a><span class="fu">### Longitudinelle data</span></span>
<span id="cb34-301"><a href="#cb34-301" aria-hidden="true" tabindex="-1"></a>Det er nok vanligst å klustre ulike variable. Men hvis variablene innholder verdier for ulike tidsenheter (f.eks. per år), så kan vi også analysere tidstrender på denne måten. Antall variable som klustres kan være flerdimensjonalt. Ovenfor er det brukt bare to variable, men normale er jo at det er langt flere dimensjoner samtidig. </span>
<span id="cb34-302"><a href="#cb34-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-303"><a href="#cb34-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-304"><a href="#cb34-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-305"><a href="#cb34-305" aria-hidden="true" tabindex="-1"></a><span class="fu">## Hierarkisk klustering </span></span>
<span id="cb34-306"><a href="#cb34-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-307"><a href="#cb34-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-308"><a href="#cb34-308" aria-hidden="true" tabindex="-1"></a>::: {#exr-}</span>
<span id="cb34-309"><a href="#cb34-309" aria-hidden="true" tabindex="-1"></a>Last ned filen med kommunedata fra Canvas. </span>
<span id="cb34-310"><a href="#cb34-310" aria-hidden="true" tabindex="-1"></a>Dette er deler av dataene vi brukte i første seminar med kommunetall. Her er det anmeldt </span>
<span id="cb34-311"><a href="#cb34-311" aria-hidden="true" tabindex="-1"></a>kriminalitet per 1000 innbyggere i kommuner i 2016. </span>
<span id="cb34-312"><a href="#cb34-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-313"><a href="#cb34-313" aria-hidden="true" tabindex="-1"></a>a) Gjør en hierarkisk klusteranalsyse. Er det noen kommuner som skiller seg veldig fra de </span>
<span id="cb34-314"><a href="#cb34-314" aria-hidden="true" tabindex="-1"></a>andre? Spiller det noen rolle hvilken type distance du setter? </span>
<span id="cb34-315"><a href="#cb34-315" aria-hidden="true" tabindex="-1"></a>a) Hvilke kommuner er de de klusterne som skiller seg ut? </span>
<span id="cb34-316"><a href="#cb34-316" aria-hidden="true" tabindex="-1"></a>a) Hva kjennetegner lovbruddsbildet i de ulike klustrene? Kan du tenke deg noen grunner til at akkurat disse stikker seg ut?</span>
<span id="cb34-317"><a href="#cb34-317" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-318"><a href="#cb34-318" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-319"><a href="#cb34-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-320"><a href="#cb34-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-321"><a href="#cb34-321" aria-hidden="true" tabindex="-1"></a>::: {.solution}</span>
<span id="cb34-322"><a href="#cb34-322" aria-hidden="true" tabindex="-1"></a>Leser inn data om inntektsutvikling for ulike yrker fra 2001 til 2016</span>
<span id="cb34-323"><a href="#cb34-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-324"><a href="#cb34-324" aria-hidden="true" tabindex="-1"></a>Dataene er i "bred" format. Det er slik vi vil ha det for clusteranalyse, men dårlig for å lage en graf.</span>
<span id="cb34-325"><a href="#cb34-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-326"><a href="#cb34-326" aria-hidden="true" tabindex="-1"></a>::: {.content-hidden when-format="pdf"}</span>
<span id="cb34-327"><a href="#cb34-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-328"><a href="#cb34-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-329"><a href="#cb34-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-332"><a href="#cb34-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-333"><a href="#cb34-333" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb34-334"><a href="#cb34-334" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-335"><a href="#cb34-335" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(downloadthis)</span>
<span id="cb34-336"><a href="#cb34-336" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"../data/oes.RData"</span>)</span>
<span id="cb34-337"><a href="#cb34-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-338"><a href="#cb34-338" aria-hidden="true" tabindex="-1"></a>gathered_oes <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> df_oes, </span>
<span id="cb34-339"><a href="#cb34-339" aria-hidden="true" tabindex="-1"></a>                       <span class="at">key =</span> year, </span>
<span id="cb34-340"><a href="#cb34-340" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value =</span> mean_salary, </span>
<span id="cb34-341"><a href="#cb34-341" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>occupation)</span>
<span id="cb34-342"><a href="#cb34-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-343"><a href="#cb34-343" aria-hidden="true" tabindex="-1"></a>gathered_oes <span class="sc">%&gt;%</span></span>
<span id="cb34-344"><a href="#cb34-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download_this</span>(</span>
<span id="cb34-345"><a href="#cb34-345" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_name =</span> <span class="st">"oes dataset"</span>,</span>
<span id="cb34-346"><a href="#cb34-346" aria-hidden="true" tabindex="-1"></a>    <span class="at">output_extension =</span> <span class="st">".rds"</span>,</span>
<span id="cb34-347"><a href="#cb34-347" aria-hidden="true" tabindex="-1"></a>    <span class="at">button_label =</span> <span class="st">"Download data as rds"</span>,</span>
<span id="cb34-348"><a href="#cb34-348" aria-hidden="true" tabindex="-1"></a>    <span class="at">button_type =</span> <span class="st">"default"</span>,</span>
<span id="cb34-349"><a href="#cb34-349" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_icon =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-350"><a href="#cb34-350" aria-hidden="true" tabindex="-1"></a>    <span class="at">icon =</span> <span class="st">"fa fa-save"</span></span>
<span id="cb34-351"><a href="#cb34-351" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-352"><a href="#cb34-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-353"><a href="#cb34-353" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-354"><a href="#cb34-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-355"><a href="#cb34-355" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-356"><a href="#cb34-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-357"><a href="#cb34-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-358"><a href="#cb34-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-361"><a href="#cb34-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-362"><a href="#cb34-362" aria-hidden="true" tabindex="-1"></a><span class="co"># load("../data/oes.RData")</span></span>
<span id="cb34-363"><a href="#cb34-363" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-364"><a href="#cb34-364" aria-hidden="true" tabindex="-1"></a><span class="co"># gathered_oes &lt;- gather(data = df_oes, </span></span>
<span id="cb34-365"><a href="#cb34-365" aria-hidden="true" tabindex="-1"></a><span class="co">#                        key = year, </span></span>
<span id="cb34-366"><a href="#cb34-366" aria-hidden="true" tabindex="-1"></a><span class="co">#                        value = mean_salary, </span></span>
<span id="cb34-367"><a href="#cb34-367" aria-hidden="true" tabindex="-1"></a><span class="co">#                        -occupation)</span></span>
<span id="cb34-368"><a href="#cb34-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-369"><a href="#cb34-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-370"><a href="#cb34-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-371"><a href="#cb34-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-372"><a href="#cb34-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-373"><a href="#cb34-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-376"><a href="#cb34-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-377"><a href="#cb34-377" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_oes, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">as.numeric</span>(year), <span class="at">y=</span>mean_salary, <span class="at">col =</span> occupation))<span class="sc">+</span></span>
<span id="cb34-378"><a href="#cb34-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb34-379"><a href="#cb34-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-380"><a href="#cb34-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-381"><a href="#cb34-381" aria-hidden="true" tabindex="-1"></a>dist_oes <span class="ot">&lt;-</span> <span class="fu">dist</span>(df_oes[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">method =</span> <span class="st">"euclidian"</span>) <span class="co"># calculate distances </span></span>
<span id="cb34-382"><a href="#cb34-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-383"><a href="#cb34-383" aria-hidden="true" tabindex="-1"></a>hc_oes <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_oes, <span class="at">method =</span> <span class="st">"single"</span>)  <span class="co"># minste avstand</span></span>
<span id="cb34-384"><a href="#cb34-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-385"><a href="#cb34-385" aria-hidden="true" tabindex="-1"></a>hc_oes <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_oes, <span class="at">method =</span> <span class="st">"complete"</span>) <span class="co"># lengste avstand</span></span>
<span id="cb34-386"><a href="#cb34-386" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-387"><a href="#cb34-387" aria-hidden="true" tabindex="-1"></a>hc_oes <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_oes, <span class="at">method =</span> <span class="st">"average"</span>) <span class="co">#gjennomsnittlig avstand</span></span>
<span id="cb34-388"><a href="#cb34-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-389"><a href="#cb34-389" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">2</span>))  <span class="co"># Endre marginer for base-plot</span></span>
<span id="cb34-390"><a href="#cb34-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-391"><a href="#cb34-391" aria-hidden="true" tabindex="-1"></a>dend_oes <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_oes) <span class="co">#Create a dendrogram object</span></span>
<span id="cb34-392"><a href="#cb34-392" aria-hidden="true" tabindex="-1"></a>dend_colored <span class="ot">&lt;-</span> <span class="fu">color_branches</span>(dend_oes, <span class="at">h =</span> <span class="dv">100000</span>)</span>
<span id="cb34-393"><a href="#cb34-393" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dend_colored)</span>
<span id="cb34-394"><a href="#cb34-394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-395"><a href="#cb34-395" aria-hidden="true" tabindex="-1"></a><span class="co"># Illustrer mulige cutoff - legger linjer oppå eksisterende plot</span></span>
<span id="cb34-396"><a href="#cb34-396" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">100000</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)  <span class="co"># Viser cut ved h=100000</span></span>
<span id="cb34-397"><a href="#cb34-397" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">10000</span>, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)   <span class="co"># Viser cut ved h=10000</span></span>
<span id="cb34-398"><a href="#cb34-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-399"><a href="#cb34-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-400"><a href="#cb34-400" aria-hidden="true" tabindex="-1"></a><span class="co"># Henter ut cluster ved valgt h</span></span>
<span id="cb34-401"><a href="#cb34-401" aria-hidden="true" tabindex="-1"></a>cluster <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc_oes, <span class="at">h=</span><span class="dv">100000</span>)</span>
<span id="cb34-402"><a href="#cb34-402" aria-hidden="true" tabindex="-1"></a><span class="co">#cluster &lt;- cutree(hc_oes, k=3)</span></span>
<span id="cb34-403"><a href="#cb34-403" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cluster)</span>
<span id="cb34-404"><a href="#cb34-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-405"><a href="#cb34-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-406"><a href="#cb34-406" aria-hidden="true" tabindex="-1"></a><span class="co"># Legger til vektoren cluster til opprinnelige data</span></span>
<span id="cb34-407"><a href="#cb34-407" aria-hidden="true" tabindex="-1"></a>hclust_oes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df_oes, <span class="at">cluster =</span> cluster)</span>
<span id="cb34-408"><a href="#cb34-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-409"><a href="#cb34-409" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hclust_oes)</span>
<span id="cb34-410"><a href="#cb34-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-411"><a href="#cb34-411" aria-hidden="true" tabindex="-1"></a><span class="co"># vrenger dataene "nedover" for å plotte</span></span>
<span id="cb34-412"><a href="#cb34-412" aria-hidden="true" tabindex="-1"></a>gathered_oes <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> hclust_oes,    <span class="co"># datasett</span></span>
<span id="cb34-413"><a href="#cb34-413" aria-hidden="true" tabindex="-1"></a>                       <span class="at">key =</span> year,           <span class="co"># navn på ny variabel, verdier hentes fra gamle variabelnavn</span></span>
<span id="cb34-414"><a href="#cb34-414" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value =</span> mean_salary,  <span class="co"># navn på ny variabel med gamle variabelverdier</span></span>
<span id="cb34-415"><a href="#cb34-415" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>occupation, <span class="sc">-</span>cluster) <span class="co"># variable som skal beholdes / grupperes etter</span></span>
<span id="cb34-416"><a href="#cb34-416" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_oes, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_salary, <span class="at">color =</span> <span class="fu">factor</span>(cluster), <span class="at">group =</span> occupation)) <span class="sc">+</span> </span>
<span id="cb34-417"><a href="#cb34-417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb34-418"><a href="#cb34-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-419"><a href="#cb34-419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-420"><a href="#cb34-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-421"><a href="#cb34-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-422"><a href="#cb34-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-423"><a href="#cb34-423" aria-hidden="true" tabindex="-1"></a>::: {#exr-}</span>
<span id="cb34-424"><a href="#cb34-424" aria-hidden="true" tabindex="-1"></a>Gjenta analysen over med k-means clustering. Hvor mange klustre bør det være? Får du samme </span>
<span id="cb34-425"><a href="#cb34-425" aria-hidden="true" tabindex="-1"></a>resultat?</span>
<span id="cb34-426"><a href="#cb34-426" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-427"><a href="#cb34-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-428"><a href="#cb34-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-429"><a href="#cb34-429" aria-hidden="true" tabindex="-1"></a>::: {.solution}</span>
<span id="cb34-430"><a href="#cb34-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-433"><a href="#cb34-433" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-434"><a href="#cb34-434" aria-hidden="true" tabindex="-1"></a><span class="do">## K-means clustering med samme data </span></span>
<span id="cb34-435"><a href="#cb34-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-436"><a href="#cb34-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Eksempel ved å sette antall kluster til 3</span></span>
<span id="cb34-437"><a href="#cb34-437" aria-hidden="true" tabindex="-1"></a><span class="co"># I dette tilfellet bør vi få samme resultat</span></span>
<span id="cb34-438"><a href="#cb34-438" aria-hidden="true" tabindex="-1"></a>km_oes <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(dist_oes, <span class="at">centers =</span> <span class="dv">3</span>)</span>
<span id="cb34-439"><a href="#cb34-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-440"><a href="#cb34-440" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km_oes<span class="sc">$</span>cluster)</span>
<span id="cb34-441"><a href="#cb34-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-442"><a href="#cb34-442" aria-hidden="true" tabindex="-1"></a>kmclust_oes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df_oes, <span class="at">cluster=</span>km_oes<span class="sc">$</span>cluster)</span>
<span id="cb34-443"><a href="#cb34-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-444"><a href="#cb34-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotter</span></span>
<span id="cb34-445"><a href="#cb34-445" aria-hidden="true" tabindex="-1"></a>gathered_kmoes <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> kmclust_oes,    <span class="co"># datasett</span></span>
<span id="cb34-446"><a href="#cb34-446" aria-hidden="true" tabindex="-1"></a>                       <span class="at">key =</span> year,           <span class="co"># navn på ny variabel, verdier hentes fra gamle variabelnavn</span></span>
<span id="cb34-447"><a href="#cb34-447" aria-hidden="true" tabindex="-1"></a>                       <span class="at">value =</span> mean_salary,  <span class="co"># navn på ny variabel med gamle variabelverdier</span></span>
<span id="cb34-448"><a href="#cb34-448" aria-hidden="true" tabindex="-1"></a>                       <span class="sc">-</span>occupation, <span class="sc">-</span>cluster) <span class="co"># variable som skal beholdes / grupperes etter</span></span>
<span id="cb34-449"><a href="#cb34-449" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_kmoes, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_salary, <span class="at">color =</span> <span class="fu">factor</span>(cluster), <span class="at">group =</span> occupation)) <span class="sc">+</span> </span>
<span id="cb34-450"><a href="#cb34-450" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb34-451"><a href="#cb34-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-452"><a href="#cb34-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-453"><a href="#cb34-453" aria-hidden="true" tabindex="-1"></a><span class="do">### K-means clustering. Make a search</span></span>
<span id="cb34-454"><a href="#cb34-454" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb34-455"><a href="#cb34-455" aria-hidden="true" tabindex="-1"></a><span class="co"># For 1 to 15 cluster centers</span></span>
<span id="cb34-456"><a href="#cb34-456" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb34-457"><a href="#cb34-457" aria-hidden="true" tabindex="-1"></a>  km.out <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(dist_oes, <span class="at">centers =</span> i, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb34-458"><a href="#cb34-458" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save total within sum of squares to wss variable</span></span>
<span id="cb34-459"><a href="#cb34-459" aria-hidden="true" tabindex="-1"></a>  wss[i] <span class="ot">&lt;-</span> km.out<span class="sc">$</span>tot.withinss</span>
<span id="cb34-460"><a href="#cb34-460" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-461"><a href="#cb34-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-462"><a href="#cb34-462" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot total within sum of squares vs. number of clusters</span></span>
<span id="cb34-463"><a href="#cb34-463" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, wss, <span class="at">type =</span> <span class="st">"b"</span>, </span>
<span id="cb34-464"><a href="#cb34-464" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Number of Clusters"</span>, </span>
<span id="cb34-465"><a href="#cb34-465" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"Within groups sum of squares"</span>)</span>
<span id="cb34-466"><a href="#cb34-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Marker "albuen" med en linje i plottet </span></span>
<span id="cb34-467"><a href="#cb34-467" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb34-468"><a href="#cb34-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-469"><a href="#cb34-469" aria-hidden="true" tabindex="-1"></a>oes <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../data/oes.rds"</span>)</span>
<span id="cb34-470"><a href="#cb34-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-471"><a href="#cb34-471" aria-hidden="true" tabindex="-1"></a><span class="do">## Create final clustering</span></span>
<span id="cb34-472"><a href="#cb34-472" aria-hidden="true" tabindex="-1"></a>km_oes <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(oes, <span class="at">centers =</span> <span class="dv">2</span>, <span class="at">nstart=</span><span class="dv">20</span>)</span>
<span id="cb34-473"><a href="#cb34-473" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(km_oes<span class="sc">$</span>cluster)</span>
<span id="cb34-474"><a href="#cb34-474" aria-hidden="true" tabindex="-1"></a>kmclust_oes <span class="ot">&lt;-</span> <span class="fu">mutate</span>(df_oes, <span class="at">cluster=</span>km_oes<span class="sc">$</span>cluster)</span>
<span id="cb34-475"><a href="#cb34-475" aria-hidden="true" tabindex="-1"></a>gathered_kmoes <span class="ot">&lt;-</span> <span class="fu">gather</span>(<span class="at">data =</span> kmclust_oes,    <span class="co"># datasett</span></span>
<span id="cb34-476"><a href="#cb34-476" aria-hidden="true" tabindex="-1"></a>                         <span class="at">key =</span> year,           <span class="co"># navn på ny variabel, verdier hentes fra gamle variabelnavn</span></span>
<span id="cb34-477"><a href="#cb34-477" aria-hidden="true" tabindex="-1"></a>                         <span class="at">value =</span> mean_salary,  <span class="co"># navn på ny variabel med gamle variabelverdier</span></span>
<span id="cb34-478"><a href="#cb34-478" aria-hidden="true" tabindex="-1"></a>                         <span class="sc">-</span>occupation, <span class="sc">-</span>cluster) <span class="co"># variable som skal beholdes / grupperes etter</span></span>
<span id="cb34-479"><a href="#cb34-479" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(gathered_kmoes, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mean_salary, <span class="at">color =</span> <span class="fu">factor</span>(cluster), <span class="at">group =</span> occupation)) <span class="sc">+</span> </span>
<span id="cb34-480"><a href="#cb34-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb34-481"><a href="#cb34-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-482"><a href="#cb34-482" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-483"><a href="#cb34-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-484"><a href="#cb34-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-485"><a href="#cb34-485" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-486"><a href="#cb34-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-487"><a href="#cb34-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-488"><a href="#cb34-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-489"><a href="#cb34-489" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb34-490"><a href="#cb34-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-491"><a href="#cb34-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-492"><a href="#cb34-492" aria-hidden="true" tabindex="-1"></a><span class="fu">## Datareduksjon med principal component analysis (PCA)</span></span>
<span id="cb34-493"><a href="#cb34-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-494"><a href="#cb34-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-495"><a href="#cb34-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-496"><a href="#cb34-496" aria-hidden="true" tabindex="-1"></a>Vi starter med datasettet for kriminalitet i norske kommuner. </span>
<span id="cb34-497"><a href="#cb34-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-500"><a href="#cb34-500" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-501"><a href="#cb34-501" aria-hidden="true" tabindex="-1"></a>kommune <span class="ot">&lt;-</span> <span class="fu">readRDS</span>( <span class="st">"data/kommunedata.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-502"><a href="#cb34-502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-503"><a href="#cb34-503" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(-c(1,3))</span></span>
<span id="cb34-504"><a href="#cb34-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">2</span>, vinningskriminalitet<span class="sc">:</span>andre_lovbrudd) </span>
<span id="cb34-505"><a href="#cb34-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-506"><a href="#cb34-506" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(kommune)</span>
<span id="cb34-507"><a href="#cb34-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-508"><a href="#cb34-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-509"><a href="#cb34-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-510"><a href="#cb34-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-511"><a href="#cb34-511" aria-hidden="true" tabindex="-1"></a>Så et lite triks som ikke er viktig for resultatet som sådan, men hjelper å holde orden på dataene. Vi er kjent med at kolonnene i et datasett har navn: altså variabelnavn. Men i R kan også *radene* ha navn. Det er ikke like vanlig å bruke til noe spesielt, men her er det nyttig å ta det med seg.  </span>
<span id="cb34-512"><a href="#cb34-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-515"><a href="#cb34-515" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-516"><a href="#cb34-516" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(kommune) <span class="ot">&lt;-</span> kommune[,<span class="dv">1</span>]</span>
<span id="cb34-517"><a href="#cb34-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-518"><a href="#cb34-518" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-519"><a href="#cb34-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-520"><a href="#cb34-520" aria-hidden="true" tabindex="-1"></a>Så kan vi kjøre en principal component analyse. Det er her viktig å sette <span class="in">`scale = TRUE`</span>. Dette gjør at dataene re-skaleres til en z-skår med gjennomsnitt 0 og standardavvik 1. Det skal veldig gode grunner for å gjøre noe annet, så gjør alltid dette.   </span>
<span id="cb34-521"><a href="#cb34-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-524"><a href="#cb34-524" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-525"><a href="#cb34-525" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb34-526"><a href="#cb34-526" aria-hidden="true" tabindex="-1"></a>pr_komm <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(kommune[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">center =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-527"><a href="#cb34-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-528"><a href="#cb34-528" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(pr_komm)</span>
<span id="cb34-529"><a href="#cb34-529" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(kommune<span class="sc">$</span>vinningskriminalitet)</span>
<span id="cb34-530"><a href="#cb34-530" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-531"><a href="#cb34-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-532"><a href="#cb34-532" aria-hidden="true" tabindex="-1"></a>pr_komm<span class="sc">$</span>center</span>
<span id="cb34-533"><a href="#cb34-533" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-534"><a href="#cb34-534" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-535"><a href="#cb34-535" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-538"><a href="#cb34-538" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-539"><a href="#cb34-539" aria-hidden="true" tabindex="-1"></a>pvar <span class="ot">&lt;-</span> pr_komm<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> </span>
<span id="cb34-540"><a href="#cb34-540" aria-hidden="true" tabindex="-1"></a>pve <span class="ot">&lt;-</span> pvar<span class="sc">/</span><span class="fu">sum</span>(pvar)</span>
<span id="cb34-541"><a href="#cb34-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-542"><a href="#cb34-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-543"><a href="#cb34-543" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, pve, )</span>
<span id="cb34-544"><a href="#cb34-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-545"><a href="#cb34-545" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">components =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pve), <span class="at">prop_var_expl =</span> pve)</span>
<span id="cb34-546"><a href="#cb34-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-547"><a href="#cb34-547" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dt, <span class="fu">aes</span>(<span class="at">x =</span> components, <span class="at">y =</span> prop_var_expl))<span class="sc">+</span> </span>
<span id="cb34-548"><a href="#cb34-548" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb34-549"><a href="#cb34-549" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb34-550"><a href="#cb34-550" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb34-551"><a href="#cb34-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-552"><a href="#cb34-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-553"><a href="#cb34-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-554"><a href="#cb34-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-555"><a href="#cb34-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-556"><a href="#cb34-556" aria-hidden="true" tabindex="-1"></a>Da kan resultatene vises grafisk som følger. </span>
<span id="cb34-557"><a href="#cb34-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-560"><a href="#cb34-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-561"><a href="#cb34-561" aria-hidden="true" tabindex="-1"></a><span class="fu">biplot</span>(pr_komm, <span class="at">cex =</span> .<span class="dv">3</span>)</span>
<span id="cb34-562"><a href="#cb34-562" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-563"><a href="#cb34-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-564"><a href="#cb34-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-565"><a href="#cb34-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-568"><a href="#cb34-568" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-569"><a href="#cb34-569" aria-hidden="true" tabindex="-1"></a>kommune_scale <span class="ot">&lt;-</span> kommune <span class="sc">%&gt;%</span> </span>
<span id="cb34-570"><a href="#cb34-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), scale)) </span>
<span id="cb34-571"><a href="#cb34-571" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(kommune_scale)</span>
<span id="cb34-572"><a href="#cb34-572" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-573"><a href="#cb34-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-574"><a href="#cb34-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-577"><a href="#cb34-577" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-578"><a href="#cb34-578" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-579"><a href="#cb34-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-580"><a href="#cb34-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-581"><a href="#cb34-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-582"><a href="#cb34-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-583"><a href="#cb34-583" aria-hidden="true" tabindex="-1"></a><span class="fu">### Multippel korrespondanseanalyse</span></span>
<span id="cb34-584"><a href="#cb34-584" aria-hidden="true" tabindex="-1"></a>PCA har egentlig som forutsetning av variablene er kontinuerlige, og det er litt trøblete å bruke det på kategoriske variable. Men ofte har vi kategoriske variable. </span>
<span id="cb34-585"><a href="#cb34-585" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-586"><a href="#cb34-586" aria-hidden="true" tabindex="-1"></a>En variant av PCA for kategoriske variable er korrespondanseanalyse, som i teorien altså skal være bedre enn PCA. I praksis er det imidlertid ikke nødvendigvis veldig stor forskjell, så det er neppe stor skade skjedd hvis man bruker PCA likevel. </span>
<span id="cb34-587"><a href="#cb34-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-588"><a href="#cb34-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-589"><a href="#cb34-589" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>